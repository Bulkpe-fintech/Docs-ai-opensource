/*! For license information please see 279.server.js.LICENSE.txt */
"use strict";exports.id=279,exports.ids=[279],exports.modules={43405:(e,t,a)=>{a.d(t,{N:()=>o});var r=a(66423),n=a(43418),i=a(5260);class s{}class o extends s{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,n.Z)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"true"!==(0,i.Az)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return n.y.prototype.toJSON.call(this)}toJSONNotImplemented(){return n.y.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends o{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:r.A()}),Object.assign(this,e)}}}}},7459:(e,t,a)=>{a.d(t,{Td:()=>W,tW:()=>Y,H_:()=>H});var r=a(66423),n=a(43405),i=a(94749),s=a(67499);function o(e,t){return`${e.open}${t}${e.close}`}function c(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function d(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:l}=i;class u extends s.J{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let a=e;for(;a.parent_run_id;){const e=this.runMap.get(a.parent_run_id);if(!e)break;t.push(e),a=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,a)=>{const r=`${e.execution_order}:${e.run_type}:${e.name}`;return t===a.length-1?o(i.bold,r):r})).join(" > ");return o(l.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.green,"[chain/start]")} [${t}] Entering Chain run with input: ${c(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.cyan,"[chain/end]")} [${t}] [${d(e)}] Exiting Chain run with output: ${c(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.red,"[chain/error]")} [${t}] [${d(e)}] Chain run errored with error: ${c(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),a="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${o(l.green,"[llm/start]")} [${t}] Entering LLM run with input: ${c(a,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.cyan,"[llm/end]")} [${t}] [${d(e)}] Exiting LLM run with output: ${c(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.red,"[llm/error]")} [${t}] [${d(e)}] LLM run errored with error: ${c(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.cyan,"[tool/end]")} [${t}] [${d(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.red,"[tool/error]")} [${t}] [${d(e)}] Tool run errored with error: ${c(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${c(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.cyan,"[retriever/end]")} [${t}] [${d(e)}] Exiting Retriever run with output: ${c(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${o(l.red,"[retriever/error]")} [${t}] [${d(e)}] Retriever run errored with error: ${c(e.error,"[error]")}`)}onAgentAction(e){const t=e,a=this.getBreadcrumbs(e);console.log(`${o(l.blue,"[agent/action]")} [${a}] Agent selected action: ${c(t.actions[t.actions.length-1],"[action]")}`)}}var h=a(75093),p=a(62196),m=a(12425);const f=[400,401,403,404,405,406,407,408],g=[409];class y{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.queue=new m.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){const a=this.onFailedResponseHook;return this.queue.add((()=>p((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response,r=t?.status;if(r){if(f.includes(+r))throw e;if(g.includes(+r))return;a&&await a(t)}},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...a){return e.signal?Promise.race([this.call(t,...a),new Promise(((t,a)=>{e.signal?.addEventListener("abort",(()=>{a(new Error("AbortError"))}))}))]):this.call(t,...a)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}function _(e){return"function"==typeof e?._getType}function v(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let b;const w=()=>"undefined"!=typeof Deno,k=()=>b||(b="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||w()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":w()?"deno":"other":"node",b);let O,x;function E(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}var T=a(74779);function I(e){if(!T.A(e))throw new Error(`Invalid UUID: ${e}`)}const S={};async function j(e){const t=await async function(){if(void 0===O){const e=k(),t=function(){if(void 0!==x)return x;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const a of e){const e=E(a);void 0!==e&&(t[a]=e)}return x=t,t}();O={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:$,...t}}return O}(),a=function(){const e=function(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce(((e,[t,a])=>(e[t]=String(a),e)),{}):void 0}catch(e){return}}()||{},t={},a=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,n]of Object.entries(e))!r.startsWith("LANGCHAIN_")||"string"!=typeof n||a.includes(r)||r.toLowerCase().includes("key")||r.toLowerCase().includes("secret")||r.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===r?t.revision_id=n:t[r]=n);return t}();return e.map((e=>{const r=e.extra??{},n=r.metadata;return e.extra={...r,runtime:{...t,...r?.runtime},metadata:{...a,...a.revision_id||e.revision_id?{revision_id:e.revision_id??a.revision_id}:{},...n}},e}))}const N=async(e,t)=>{const a=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${a}`)};function P(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const A=async e=>{if(429===e?.status){const t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise((e=>setTimeout(e,t))),!0}return!1};class C{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise((t=>{this.items.push([e,t])}))}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const t=[];for(;t.length<e&&this.items.length;){const e=this.items.shift();if(!e)break;t.push(e)}return[t.map((e=>e[0])),()=>t.forEach((e=>e[1]()))]}}class R{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new C}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=R.getDefaultClientConfig();this.tracingSampleRate=(()=>{const e=E("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===e)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t})(),this.apiUrl=P(e.apiUrl??t.apiUrl)??"",this.apiKey=P(e.apiKey??t.apiKey),this.webUrl=P(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new y(e.callerOptions??{}),this.batchIngestCaller=new y({...e.callerOptions??{},onFailedResponseHook:A}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=E("LANGCHAIN_API_KEY");return{apiUrl:E("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===E("LANGCHAIN_HIDE_INPUTS"),hideOutputs:"true"===E("LANGCHAIN_HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(e=>{const t=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t})()?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${$}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const a=t?.toString()??"",r=`${this.apiUrl}${e}?${a}`,n=await this.caller.call(fetch,r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);return n}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let a=Number(t.get("offset"))||0;const r=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(r));const n=`${this.apiUrl}${e}?${t}`,i=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);const s=await i.json();if(0===s.length)break;if(yield s,s.length<r)break;a+=s.length}}async*_getCursorPaginatedList(e,t=null,a="POST",r="runs"){const n=t?{...t}:{};for(;;){const t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:a,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(n)}),i=await t.json();if(!i)break;if(!i[r])break;yield i[r];const s=i.cursors;if(!s)break;if(!s.next)break;n.cursor=s.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){const t=[];for(const a of e)this.sampledPostUuids.has(a.id)&&(t.push(a),this.sampledPostUuids.delete(a.id));return t}{const t=[];for(const a of e)Math.random()<this.tracingSampleRate&&(t.push(a),this.sampledPostUuids.add(a.id));return t}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length)return void t();try{await this.batchIngestRuns({runCreates:e.filter((e=>"create"===e.action)).map((e=>e.item)),runUpdates:e.filter((e=>"update"===e.action)).map((e=>e.item))})}finally{t()}}}async processRunOperation(e,t){const a=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const r=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout((()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)}),a?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),r}async _getServerInfo(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},a=e.project_name;delete e.project_name;const r=this.prepareRunCreateOrUpdateInputs({session_name:a,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order)return void this.processRunOperation({action:"create",item:r}).catch(console.error);const n=await j([r]),i=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(n[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await N(i,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let a=e?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[],r=t?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[];if(a.length>0&&r.length>0){const e=a.reduce(((e,t)=>t.id?(e[t.id]=t,e):e),{}),t=[];for(const a of r)void 0!==a.id&&e[a.id]?e[a.id]={...e[a.id],...a}:t.push(a);a=Object.values(e),r=t}const n={post:this._filterForSampling(a),patch:this._filterForSampling(r,!0)};if(!n.post.length&&!n.patch.length)return;if(a=await j(a),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const e of n.post)await this.createRun(e);for(const e of n.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}const i=this.serverInfo?.batch_ingest_config?.size_limit_bytes??20971520,s={post:[],patch:[]};let o=0;for(const e of["post","patch"]){const t=e,a=n[t].reverse();let r=a.pop();for(;void 0!==r;){const e=JSON.stringify(r);o>0&&o+e.length>i&&(await this._postBatchIngestRuns(JSON.stringify(s)),o=0,s.post=[],s.patch=[]),o+=e.length,s[t].push(r),r=a.pop()}}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(s))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},a=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await N(a,"batch create run")}async updateRun(e,t){I(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const a={...t,id:e};if(!this._filterForSampling([a],!0).length)return;if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order)return void 0!==t.end_time&&void 0===a.parent_run_id?void await this.processRunOperation({action:"update",item:a},!0):void this.processRunOperation({action:"update",item:a}).catch(console.error);const r={...this.headers,"Content-Type":"application/json"},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await N(n,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){I(e);let a=await this._get(`/runs/${e}`);return t&&a.child_run_ids&&(a=await this._loadChildRuns(a)),a}async getRunUrl({runId:e,run:t,projectOpts:a}){if(void 0!==t){let e;e=t.session_id?t.session_id:a?.projectName?(await this.readProject({projectName:a?.projectName})).id:a?.projectId?a?.projectId:(await this.readProject({projectName:E("LANGCHAIN_PROJECT")||"default"})).id;const r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const a of e)t.push(a);return t}(this.listRuns({id:e.child_run_ids})),a={},r={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in a||(a[e.parent_run_id]=[]),a[e.parent_run_id].push(e),r[e.id]=e}e.child_runs=a[e.id]||[];for(const t in a)t!==e.id&&(r[t].child_runs=a[t]);return e}async*listRuns(e){const{projectId:t,projectName:a,parentRunId:r,traceId:n,referenceExampleId:i,startTime:s,executionOrder:o,isRoot:c,runType:d,error:l,id:u,query:h,filter:p,traceFilter:m,treeFilter:f,limit:g,select:y}=e;let _=[];if(t&&(_=Array.isArray(t)?t:[t]),a){const e=Array.isArray(a)?a:[a],t=await Promise.all(e.map((e=>this.readProject({projectName:e}).then((e=>e.id)))));_.push(...t)}const v={session:_.length?_:null,run_type:d,reference_example:i,query:h,filter:p,trace_filter:m,tree_filter:f,execution_order:o,parent_run:r,start_time:s?s.toISOString():null,error:l,id:u,limit:g,trace:n,select:y||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:c};let b=0;for await(const e of this._getCursorPaginatedList("/runs/query",v))if(g){if(b>=g)break;if(e.length+b>g){const t=e.slice(0,g-b);yield*t;break}b+=e.length,yield*e}else yield*e}async shareRun(e,{shareId:t}={}){const a={run_id:e,share_token:t||h.A()};I(e);const r=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await r.json();if(null===n||!("share_token"in n))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${n.share_token}/r`}async unshareRun(e){I(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await N(t,"unshare run")}async readRunSharedLink(e){I(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await t.json();if(null!==a&&"share_token"in a)return`${this.getHostUrl()}/public/${a.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const a=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)a.append("id",e);I(e);const r=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),I(e);const a=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await a.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const a={dataset_id:e};I(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await r.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){I(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await N(t,"unshare dataset")}async readSharedDataset(e){I(e);const t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async createProject({projectName:e,description:t=null,metadata:a=null,upsert:r=!1,projectExtra:n=null,referenceDatasetId:i=null}){const s=r?"?upsert=true":"",o=`${this.apiUrl}/sessions${s}`,c=n||{};a&&(c.metadata=a);const d={name:e,extra:c,description:t};null!==i&&(d.reference_dataset_id=i);const l=await this.caller.call(fetch,o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),u=await l.json();if(!l.ok)throw new Error(`Failed to create session ${e}: ${l.status} ${l.statusText}`);return u}async updateProject(e,{name:t=null,description:a=null,metadata:r=null,projectExtra:n=null,endTime:i=null}){const s=`${this.apiUrl}/sessions/${e}`;let o=n;r&&(o={...o||{},metadata:r});const c={name:t,extra:o,description:a,end_time:i?new Date(i).toISOString():null},d=await this.caller.call(fetch,s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),l=await d.json();if(!d.ok)throw new Error(`Failed to update project ${e}: ${d.status} ${d.statusText}`);return l}async hasProject({projectId:e,projectName:t}){let a="/sessions";const r=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)I(e),a+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");r.append("name",t)}const n=await this.caller.call(fetch,`${this.apiUrl}${a}?${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const e=await n.json();return!!n.ok&&(!Array.isArray(e)||e.length>0)}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:a}){let r="/sessions";const n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)I(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");n.append("name",t)}void 0!==a&&n.append("include_stats",a.toString());const i=await this._get(r,n);let s;if(Array.isArray(i)){if(0===i.length)throw new Error(`Project[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either projectName or projectId");const a=await this.readProject({projectId:e,projectName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${a.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either datasetName or datasetId");const a=await this.readDataset({datasetId:e,datasetName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/datasets/${a.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:a,referenceDatasetId:r,referenceDatasetName:n,referenceFree:i}={}){const s=new URLSearchParams;if(void 0!==e)for(const t of e)s.append("id",t);if(void 0!==t&&s.append("name",t),void 0!==a&&s.append("name_contains",a),void 0!==r)s.append("reference_dataset",r);else if(void 0!==n){const e=await this.readDataset({datasetName:n});s.append("reference_dataset",e.id)}void 0!==i&&s.append("reference_free",i.toString());for await(const e of this._getPaginated("/sessions",s))yield*e}async deleteProject({projectId:e,projectName:t}){let a;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");a=void 0===e?(await this.readProject({projectName:t})).id:e,I(a);const r=await this.caller.call(fetch,`${this.apiUrl}/sessions/${a}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await N(r,`delete session ${a} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:a,outputKeys:r,description:n,dataType:i,name:s}){const o=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),a.forEach((e=>{c.append("input_keys",e)})),r.forEach((e=>{c.append("output_keys",e)})),n&&c.append("description",n),i&&c.append("data_type",i),s&&c.append("name",s);const d=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!d.ok){const e=await d.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${d.status} ${d.statusText}`)}return await d.json()}async createDataset(e,{description:t,dataType:a}={}){const r={name:e,description:t};a&&(r.data_type=a);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok){const t=await n.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${n.status} ${n.statusText}`)}return await n.json()}async readDataset({datasetId:e,datasetName:t}){let a="/datasets";const r=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)I(e),a+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");r.append("name",t)}const n=await this._get(a,r);let i;if(Array.isArray(n)){if(0===n.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=n[0]}else i=n;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:a,toVersion:r}){let n=e;if(void 0===n&&void 0===t)throw new Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:"string"==typeof a?a:a.toISOString(),to_version:"string"==typeof r?r:r.toISOString()});return await this._get(`/datasets/${n}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const a=await this._getResponse(`/datasets/${e}/openai_ft`);return(await a.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:a,datasetName:r,datasetNameContains:n}={}){const i=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==a)for(const e of a)i.append("id",e);void 0!==r&&i.append("name",r),void 0!==n&&i.append("name_contains",n);for await(const e of this._getPaginated("/datasets",i))yield*e}async updateDataset(e){const{datasetId:t,datasetName:a,...r}=e;if(!t&&!a)throw new Error("Must provide either datasetName or datasetId");const n=t??(await this.readDataset({datasetName:a})).id;I(n);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets/${n}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to update dataset ${n}: ${i.status} ${i.statusText}`);return await i.json()}async deleteDataset({datasetId:e,datasetName:t}){let a="/datasets",r=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(r=(await this.readDataset({datasetName:t})).id),void 0===r)throw new Error("Must provide datasetName or datasetId");I(r),a+=`/${r}`;const n=await this.caller.call(fetch,this.apiUrl+a,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${a}: ${n.status} ${n.statusText}`);await n.json()}async createExample(e,t,{datasetId:a,datasetName:r,createdAt:n,exampleId:i,metadata:s,split:o}){let c=a;if(void 0===c&&void 0===r)throw new Error("Must provide either datasetName or datasetId");if(void 0!==c&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");void 0===c&&(c=(await this.readDataset({datasetName:r})).id);const d=n||new Date,l={dataset_id:c,inputs:e,outputs:t,created_at:d?.toISOString(),id:i,metadata:s,split:o},u=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!u.ok)throw new Error(`Failed to create example: ${u.status} ${u.statusText}`);return await u.json()}async createExamples(e){const{inputs:t,outputs:a,metadata:r,sourceRunIds:n,exampleIds:i,datasetId:s,datasetName:o}=e;let c=s;if(void 0===c&&void 0===o)throw new Error("Must provide either datasetName or datasetId");if(void 0!==c&&void 0!==o)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===c){const e=await this.readDataset({datasetName:o});c=e.id}const d=t.map(((t,s)=>({dataset_id:c,inputs:t,outputs:a?a[s]:void 0,metadata:r?r[s]:void 0,split:e.splits?e.splits[s]:void 0,id:i?i[s]:void 0,source_run_id:n?n[s]:void 0}))),l=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok)throw new Error(`Failed to create examples: ${l.status} ${l.statusText}`);return await l.json()}async createLLMExample(e,t,a){return this.createExample({input:e},{output:t},a)}async createChatExample(e,t,a){const r=e.map((e=>_(e)?v(e):e)),n=_(t)?v(t):t;return this.createExample({input:r},{output:n},a)}async readExample(e){I(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:a,asOf:r,splits:n,inlineS3Urls:i,metadata:s}={}){let o;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)o=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");o=(await this.readDataset({datasetName:t})).id}const c=new URLSearchParams({dataset:o}),d=r?"string"==typeof r?r:r?.toISOString():void 0;d&&c.append("as_of",d);const l=i??!0;if(c.append("inline_s3_urls",l.toString()),void 0!==a)for(const e of a)c.append("id",e);if(void 0!==n)for(const e of n)c.append("splits",e);if(void 0!==s){const e=JSON.stringify(s);c.append("metadata",e)}for await(const e of this._getPaginated("/examples",c))yield*e}async deleteExample(e){I(e);const t=`/examples/${e}`,a=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to delete ${t}: ${a.status} ${a.statusText}`);await a.json()}async updateExample(e,t){I(e);const a=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to update example ${e}: ${a.status} ${a.statusText}`);return await a.json()}async evaluateRun(e,t,{sourceInfo:a,loadChildRuns:r,referenceExample:n}={loadChildRuns:!1}){var i;let s;if(S[i="This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."]||(console.warn(i),S[i]=!0),"string"==typeof e)s=await this.readRun(e,{loadChildRuns:r});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);s=e}null!==s.reference_example_id&&void 0!==s.reference_example_id&&(n=await this.readExample(s.reference_example_id));const o=await t.evaluateRun(s,n),[c,d]=await this._logEvaluationFeedback(o,s,a);return d[0]}async createFeedback(e,t,{score:a,value:r,correction:n,comment:i,sourceInfo:s,feedbackSourceType:o="api",sourceRunId:c,feedbackId:d,feedbackConfig:l,projectId:u,comparativeExperimentId:p}){if(!e&&!u)throw new Error("One of runId or projectId must be provided");if(e&&u)throw new Error("Only one of runId or projectId can be provided");const m={type:o??"api",metadata:s??{}};void 0===c||void 0===m?.metadata||m.metadata.__run||(m.metadata.__run={run_id:c}),void 0!==m?.metadata&&void 0!==m.metadata.__run?.run_id&&I(m.metadata.__run.run_id);const f={id:d??h.A(),run_id:e,key:t,score:a,value:r,correction:n,comment:i,feedback_source:m,comparative_experiment_id:p,feedbackConfig:l,session_id:u},g=`${this.apiUrl}/feedback`,y=await this.caller.call(fetch,g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await N(y,"create feedback"),f}async updateFeedback(e,{score:t,value:a,correction:r,comment:n}){const i={};null!=t&&(i.score=t),null!=a&&(i.value=a),null!=r&&(i.correction=r),null!=n&&(i.comment=n),I(e);const s=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await N(s,"update feedback")}async readFeedback(e){I(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){I(e);const t=`/feedback/${e}`,a=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to delete ${t}: ${a.status} ${a.statusText}`);await a.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:a}={}){const r=new URLSearchParams;if(e&&r.append("run",e.join(",")),t)for(const e of t)r.append("key",e);if(a)for(const e of a)r.append("source",e);for await(const e of this._getPaginated("/feedback",r))yield*e}async createPresignedFeedbackToken(e,t,{expiration:a,feedbackConfig:r}={}){const n={run_id:e,feedback_key:t,feedback_config:r};a?"string"==typeof a?n.expires_at=a:(a?.hours||a?.minutes||a?.days)&&(n.expires_in=a):n.expires_in={hours:3};const i=await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await i.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:a,createdAt:r,description:n,metadata:i,id:s}){if(0===t.length)throw new Error("At least one experiment is required");if(a||(a=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!a)throw new Error("A reference dataset is required");const o={id:s,name:e,experiment_ids:t,reference_dataset_id:a,description:n,created_at:(r??new Date)?.toISOString(),extra:{}};i&&(o.extra.metadata=i);const c=await this.caller.call(fetch,`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await c.json()}async*listPresignedFeedbackTokens(e){I(e);const t=new URLSearchParams({run_id:e});for await(const e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){let t;return t="results"in e?e.results:[e],t}async _logEvaluationFeedback(e,t,a){const r=this._selectEvalResults(e),n=[];for(const e of r){let r=a||{};e.evaluatorInfo&&(r={...e.evaluatorInfo,...r});let i=null;e.targetRunId?i=e.targetRunId:t&&(i=t.id),n.push(await this.createFeedback(i,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:r,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[r,n]}async logEvaluationFeedback(e,t,a){const[r]=await this._logEvaluationFeedback(e,t,a);return r}}const $="0.1.34";var L=a(5260);class M extends s.J{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:a,client:r}=e;this.projectName=a??(0,L.Az)("LANGCHAIN_PROJECT")??(0,L.Az)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=r??new R({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await(0,L.Ec)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}}var Z=a(44450);let D;async function U(e,t){!0===t?await e():(void 0===D&&(D=new(0,m.default)({autoStart:!0,concurrency:1})),D.add(e))}function H(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}s.J,"true"===(0,L.Az)("LANGCHAIN_TRACING_V2")&&"true"!==(0,L.Az)("LANGCHAIN_CALLBACKS_BACKGROUND")&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join("\n");class F{setHandler(e){return this.setHandlers([e])}}class B{constructor(e,t,a,r,n,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>U((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class z extends B{getChild(e){const t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}class J extends B{async handleLLMNewToken(e,t,a,r,n,i){await Promise.all(this.handlers.map((a=>U((async()=>{if(!a.ignoreLLM)try{await(a.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMNewToken: ${e}`)}}),a.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}class V extends B{getChild(e){const t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,a,r,n){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e,t,a,r,n){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}class G extends B{getChild(e){const t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>U((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}class W extends F{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,a=void 0,n=void 0,i=void 0,s=void 0,o=void 0,c=void 0){return Promise.all(t.map((async(t,n)=>{const s=0===n&&a?a:(0,r.A)();return await Promise.all(this.handlers.map((a=>U((async()=>{if(!a.ignoreLLM)try{await(a.handleLLMStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,c))}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}}),a.awaitHandlers)))),new J(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,a=void 0,n=void 0,i=void 0,s=void 0,o=void 0,c=void 0){return Promise.all(t.map((async(t,n)=>{const s=0===n&&a?a:(0,r.A)();return await Promise.all(this.handlers.map((a=>U((async()=>{if(!a.ignoreLLM)try{if(a.handleChatModelStart)await(a.handleChatModelStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,c));else if(a.handleLLMStart){const r=(0,Z.Sw)(t);await(a.handleLLMStart?.(e,[r],s,this._parentRunId,i,this.tags,this.metadata,c))}}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}}),a.awaitHandlers)))),new J(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,a=(0,r.A)(),n=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>U((async()=>{if(!r.ignoreChain)try{await(r.handleChainStart?.(e,t,a,this._parentRunId,this.tags,this.metadata,n,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleChainStart: ${e}`)}}),r.awaitHandlers)))),new V(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,a=(0,r.A)(),n=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>U((async()=>{if(!r.ignoreAgent)try{await(r.handleToolStart?.(e,t,a,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleToolStart: ${e}`)}}),r.awaitHandlers)))),new G(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,a=(0,r.A)(),n=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>U((async()=>{if(!r.ignoreRetriever)try{await(r.handleRetrieverStart?.(e,t,a,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleRetrieverStart: ${e}`)}}),r.awaitHandlers)))),new z(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const a of e)this.addHandler(a,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const a=new W(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);a.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);a.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);a.addMetadata({[e]:this.metadata[e]},t)}for(const r of e)a.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===r.name))||a.addHandler(r,t);return a}static fromHandlers(e){class t extends n.N{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,r.A)()}),Object.assign(this,e)}}const a=new this;return a.addHandler(new t),a}static async configure(e,t,a,r,n,i,s){let o;(e||t)&&(Array.isArray(e)||!e?(o=new W,o.setHandlers(e?.map(Y)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(Y):t?.handlers,!1));const c="true"===(0,L.Az)("LANGCHAIN_VERBOSE")||s?.verbose,d="true"===(0,L.Az)("LANGCHAIN_TRACING_V2"),l=d||((0,L.Az)("LANGCHAIN_TRACING")??!1);if(c||l){if(o||(o=new W),c&&!o.handlers.some((e=>e.name===u.prototype.name))){const e=new u;o.addHandler(e,!0)}l&&!o.handlers.some((e=>"langchain_tracer"===e.name))&&d&&o.addHandler(await async function(){return new M}(),!0)}return(a||r)&&o&&(o.addTags(a??[]),o.addTags(r??[],!1)),(n||i)&&o&&(o.addMetadata(n??{}),o.addMetadata(i??{},!1)),o}}function Y(e){return"name"in e?e:n.N.fromMethods(e)}},43418:(e,t,a)=>{a.d(t,{y:()=>d,Z:()=>c});var r=a(50409);function n(e,t){return t?.[e]||r(e)}function i(e,t,a){const r={};for(const n in e)Object.hasOwn(e,n)&&(r[t(n,a)]=e[n]);return r}function s(e){return Array.isArray(e)?[...e]:{...e}}function o(e,t){const a=s(e);for(const[e,r]of Object.entries(t)){const[t,...n]=e.split(".").reverse();let i=a;for(const e of n.reverse()){if(void 0===i[e])break;i[e]=s(i[e]),i=i[e]}void 0!==i[t]&&(i[t]={lc:1,type:"secret",id:[r]})}return a}function c(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}a(75832);class d{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,c(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof d||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},a=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let r=Object.getPrototypeOf(this);r;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r,"lc_aliases",this)),Object.assign(t,Reflect.get(r,"lc_secrets",this)),Object.assign(a,Reflect.get(r,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,r=a;const[n,...i]=e.split(".").reverse();for(const e of i.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}n in t&&void 0!==t[n]&&(r[n]=r[n]||t[n])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:i(Object.keys(t).length?o(a,t):a,n,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},12254:(e,t,a)=>{a.d(t,{H:()=>o,Od:()=>s});var r=a(64293),n=a(54305),i=a(95886);class s extends n.XQ{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let a;if("string"==typeof e)a={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{a=e;const t=a.additional_kwargs?.tool_calls,r=a.tool_calls;null!=t&&t.length>0&&(void 0===r||0===r.length)&&console.warn(["New LangChain packages are available that more efficiently handle","tool calling.\n\nPlease upgrade your packages to versions that set","message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(null!=t&&void 0===r){const[e,r]=(0,i.p1)(t);a.tool_calls=e??[],a.invalid_tool_calls=r??[]}else a.tool_calls=a.tool_calls??[],a.invalid_tool_calls=a.invalid_tool_calls??[]}catch(e){a.tool_calls=[],a.invalid_tool_calls=[]}}super(a),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),"string"!=typeof a&&(this.tool_calls=a.tool_calls??this.tool_calls,this.invalid_tool_calls=a.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}}class o extends n.gj{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const a=[],n=[];for(const t of e.tool_call_chunks){let e={};try{if(e=(0,r.d)(t.args??"{}")??{},"object"!=typeof e||Array.isArray(e))throw new Error("Malformed tool call chunk args.");a.push({name:t.name??"",args:e,id:t.id})}catch(e){n.push({name:t.name,args:t.args,id:t.id,error:"Malformed args."})}}t={...e,tool_calls:a,invalid_tool_calls:n}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=t?.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t?.tool_calls??this.tool_calls,this.invalid_tool_calls=t?.invalid_tool_calls??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const t={content:(0,n._I)(this.content,e.content),additional_kwargs:(0,n.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,n.ns)(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){const a=(0,n.Vt)(this.tool_call_chunks,e.tool_call_chunks);void 0!==a&&a.length>0&&(t.tool_call_chunks=a)}return new o(t)}}},54305:(e,t,a)=>{a.d(t,{AJ:()=>l,Vt:()=>o,XQ:()=>i,_I:()=>n,gj:()=>c,ns:()=>s,ny:()=>d});var r=a(43418);function n(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class i extends r.y{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function s(e,t){const a={...e};for(const[e,r]of Object.entries(t))if(null==a[e])a[e]=r;else{if(null==r)continue;if(typeof a[e]!=typeof r||Array.isArray(a[e])!==Array.isArray(r))throw new Error(`field[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof a[e])a[e]=a[e]+r;else if(Array.isArray(a[e])||"object"!=typeof a[e])if(Array.isArray(a[e]))a[e]=o(a[e],r);else{if(a[e]===r)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else a[e]=s(a[e],r)}return a}function o(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{const a=[...e];for(const e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){const t=a.findIndex((t=>t.index===e.index));-1!==t?a[t]=s(a[t],e):a.push(e)}else a.push(e);return a}}}class c extends i{}function d(e){return"function"==typeof e?._getType}function l(e){return d(e)&&"function"==typeof e.concat}},48310:(e,t,a)=>{a.d(t,{X:()=>i,c:()=>n});var r=a(54305);class n extends r.XQ{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return n}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}class i extends r.gj{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new i({content:(0,r._I)(this.content,e.content),additional_kwargs:(0,r.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r.ns)(this.response_metadata,e.response_metadata),role:this.role})}}},78424:(e,t,a)=>{a.d(t,{F:()=>n});var r=a(54305);r.XQ;class n extends r.gj{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new n({content:(0,r._I)(this.content,e.content),additional_kwargs:(0,r.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r.ns)(this.response_metadata,e.response_metadata),name:this.name??""})}}},23079:(e,t,a)=>{a.d(t,{a:()=>i,x:()=>n});var r=a(54305);class n extends r.XQ{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class i extends r.gj{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new i({content:(0,r._I)(this.content,e.content),additional_kwargs:(0,r.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r.ns)(this.response_metadata,e.response_metadata)})}}},44450:(e,t,a)=>{a.d(t,{H:()=>r.H,K0:()=>c.K0,Od:()=>r.Od,Sw:()=>c.Sw,XQ:()=>n.XQ,cM:()=>i.c,ny:()=>n.ny,tn:()=>o.t,xc:()=>s.x});var r=a(12254),n=a(54305),i=a(48310),s=(a(78424),a(23079)),o=a(27109),c=a(84387);a(95886)},27109:(e,t,a)=>{a.d(t,{t:()=>n,u:()=>i});var r=a(54305);class n extends r.XQ{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class i extends r.gj{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new i({content:(0,r._I)(this.content,e.content),additional_kwargs:(0,r.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r.ns)(this.response_metadata,e.response_metadata)})}}},95886:(e,t,a)=>{a.d(t,{p1:()=>n});var r=a(54305);function n(e){const t=[],a=[];for(const r of e)if(r.function){const e=r.function.name;try{const a={name:e||"",args:JSON.parse(r.function.arguments)||{},id:r.id};t.push(a)}catch(t){a.push({name:e,args:r.function.arguments,id:r.id,error:"Malformed args."})}}return[t,a]}r.XQ,r.gj},84387:(e,t,a)=>{a.d(t,{K0:()=>d,Sw:()=>l,ih:()=>u});var r=a(54305),n=a(23079),i=a(12254),s=a(27109),o=a(48310),c=a(78424);function d(e){if("string"==typeof e)return new n.x(e);if((0,r.ny)(e))return e;const[t,a]=e;if("human"===t||"user"===t)return new n.x({content:a});if("ai"===t||"assistant"===t)return new i.Od({content:a});if("system"===t)return new s.t({content:a});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function l(e,t="Human",a="AI"){const r=[];for(const n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=a;else if("system"===n._getType())e="System";else if("function"===n._getType())e="Function";else if("tool"===n._getType())e="Tool";else{if("generic"!==n._getType())throw new Error(`Got unsupported message type: ${n._getType()}`);e=n.role}const i=n.name?`${n.name}, `:"";r.push(`${e}: ${i}${n.content}`)}return r.join("\n")}function u(e){const t=e._getType();if("human"===t)return new n.a({...e});if("ai"===t)return new i.H({...e});if("system"===t)return new s.u({...e});if("function"===t)return new c.F({...e});if(o.c.isInstance(e))return new o.X({...e});throw new Error("Unknown message type.")}a(95886)},85760:(e,t,a)=>{a.d(t,{HY:()=>s,aB:()=>o,vX:()=>c});var r=a(43418),n=a(44450);class i extends r.y{}class s extends i{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new n.xc(this.value)]}}class o extends i{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,n.Sw)(this.messages)}toChatMessages(){return this.messages}}class c extends i{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new n.xc({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}},16158:(e,t,a)=>{a.d(t,{YN:()=>A,B2:()=>H,fJ:()=>C,jY:()=>Z,ck:()=>M,GH:()=>P,Bp:()=>U});var r=a(68576),n=a(26742),i=a(7459),s=a(28431),o=a(67499),c=a(24231),d=a(44450);class l{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),a=(0,s.X6)({},t);return new u({ops:t,state:a[a.length-1].newDocument})}}class u extends l{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),a=(0,s.X6)(this.state,e.ops);return new u({ops:t,state:a[a.length-1].newDocument})}static fromRunLogPatch(e){const t=(0,s.X6)({},e.ops);return new u({ops:e.ops,state:t[t.length-1].newDocument})}}async function h(e,t){if("original"===t)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:a}=e;return["retriever","llm","prompt"].includes(e.run_type)?a:1!==Object.keys(a).length||""!==a?.input?a.input:void 0}async function p(e,t){const{outputs:a}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?a:void 0!==a&&1===Object.keys(a).length&&void 0!==a?.output?a.output:a}class m extends o.J{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=c.bO.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let a=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(a=a||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(a=a||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(a=a||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(a=a&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(a=a&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(a=a&&t.every((e=>!this.excludeTags?.includes(e)))),a}async*tapOutputIterable(e,t){for await(const a of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new l({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:a}]}))}yield a}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new l({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const a={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(a.inputs=await h(e,this._schemaFormat)),await this.writer.write(new l({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:a}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const a=[];"streaming_events"===this._schemaFormat&&a.push({op:"replace",path:`/logs/${t}/inputs`,value:await h(e,this._schemaFormat)}),a.push({op:"add",path:`/logs/${t}/final_output`,value:await p(e,this._schemaFormat)}),void 0!==e.end_time&&a.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const r=new l({ops:a});await this.writer.write(r)}finally{if(e.id===this.rootId){const t=new l({ops:[{op:"replace",path:"/final_output",value:await p(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,a){const r=this.keyMapByRunId[e.id];if(void 0===r)return;let n;var i;void 0!==e.inputs.messages?(i=a?.chunk,n=void 0!==i&&void 0!==i.message?a?.chunk:new d.H(t)):n=t;const s=new l({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${r}/streamed_output/-`,value:n}]});await this.writer.write(s)}}var f=a(43418),g=a(49868),y=a(3817);class _ extends o.J{constructor({config:e,onStart:t,onEnd:a,onError:r}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=a,this.argOnError=r}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}function v(e){return!!e&&e.lc_runnable}class b{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let a=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const r=e.tags??[];return void 0!==this.includeNames&&(a=a||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(a=a||this.includeTypes.includes(t)),void 0!==this.includeTags&&(a=a||r.some((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(a=a&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(a=a&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(a=a&&r.every((e=>!this.excludeTags?.includes(e)))),a}}var w=a(3232),k=a(63177),O=a(1617),x=a(66423);function E(e){return v(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...(0,k.Ik)(e.data.schema),title:e.data.name}}}class T{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach(((t,a)=>{e[t.id]=(0,O.A)(t.id)?a:t.id})),{nodes:Object.values(this.nodes).map((t=>({id:e[t.id],...E(t)}))),edges:this.edges.map((t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]}))}}addNode(e,t){if(void 0!==t&&void 0!==this.nodes[t])throw new Error(`Node with id ${t} already exists`);const a=t||(0,x.A)(),r={id:a,data:e};return this.nodes[a]=r,r}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter((t=>t.source!==e.id&&t.target!==e.id))}addEdge(e,t,a){if(void 0===this.nodes[e.id])throw new Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw new Error(`Target node ${t.id} not in graph`);const r={source:e.id,target:t.id,data:a};return this.edges.push(r),r}firstNode(){const e=new Set(this.edges.map((e=>e.target))),t=[];return Object.values(this.nodes).forEach((a=>{e.has(a.id)||t.push(a)})),t[0]}lastNode(){const e=new Set(this.edges.map((e=>e.source))),t=[];return Object.values(this.nodes).forEach((a=>{e.has(a.id)||t.push(a)})),t[0]}extend(e){Object.entries(e.nodes).forEach((([e,t])=>{this.nodes[e]=t})),this.edges=[...this.edges,...e.edges]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter((t=>t.source===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter((t=>t.target===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}}function I(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function S(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*j(e,t){const a=w.N.getInstance();for(;;){const{value:r,done:n}=a.run(e,t.next.bind(t));if(n)break;yield r}}async function*N(e,t){const a=w.N.getInstance(),r=t[Symbol.asyncIterator]();for(;;){const{value:n,done:i}=await a.run(e,r.next.bind(t));if(i)break;yield n}}function P(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class A extends f.y{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new C({bound:this,kwargs:e,config:{}})}map(){return new R({bound:this})}withRetry(e){return new $({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new C({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new D({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(g.ZI);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const a=Object.fromEntries(Object.entries(e).filter((([e])=>"runId"!==e)));return Array.from({length:t},((t,r)=>(0,g.ZI)(0===r?e:a)))}return Array.from({length:t},(()=>(0,g.ZI)(e)))}async batch(e,t,a){const r=this._getOptionsList(t??{},e.length),n=r[0]?.maxConcurrency??a?.maxConcurrency,i=new y.g({maxConcurrency:n,onFailedAttempt:e=>{throw e}}),s=e.map(((e,t)=>i.call((async()=>{try{return await this.invoke(e,r[t])}catch(e){if(a?.returnExceptions)return e;throw e}}))));return Promise.all(s)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const a=new c.Tr(this._streamIterator(e,(0,g.ZI)(t)));return await a.setup,c.bO.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?(0,g.ZI)(e):(0,g.ZI)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const a={...e};return delete a.callbacks,delete a.tags,delete a.metadata,delete a.runName,delete a.configurable,delete a.recursionLimit,delete a.maxConcurrency,delete a.runId,[t,a]}async _callWithConfig(e,t,a){const r=(0,g.ZI)(a),n=await(0,g.kJ)(r),i=await(n?.handleChainStart(this.toJSON(),P(t,"input"),r.runId,r?.runType,void 0,void 0,r?.runName??this.getName()));let s;delete r.runId;try{s=await e.call(this,t,r,i)}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(P(s,"output"))),s}async _batchWithConfig(e,t,a,r){const n=this._getOptionsList(a??{},t.length),i=await Promise.all(n.map(g.kJ)),s=await Promise.all(i.map((async(e,a)=>{const r=await(e?.handleChainStart(this.toJSON(),P(t[a],"input"),n[a].runId,n[a].runType,void 0,void 0,n[a].runName??this.getName()));return delete n[a].runId,r})));let o;try{o=await e.call(this,t,n,s,r)}catch(e){throw await Promise.all(s.map((t=>t?.handleChainError(e)))),e}return await Promise.all(s.map((e=>e?.handleChainEnd(P(o,"output"))))),o}async*_transformStreamWithConfig(e,t,a){let r,n,i=!0,s=!0;const o=(0,g.ZI)(a),d=await(0,g.kJ)(o);let l;try{const a=await(0,c.DS)(t.bind(this),async function*(){for await(const t of e){if(i)if(void 0===r)r=t;else try{r=(0,c.xW)(r,t)}catch{r=void 0,i=!1}yield t}}(),(async()=>d?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName())),o);delete o.runId,l=a.setup;const u=e=>"log_stream_tracer"===e.name,h=l?.handlers.find(u);let p=a.output;void 0!==h&&void 0!==l&&(p=await h.tapOutputIterable(l.runId,a.output));for await(const e of p)if(yield e,s)if(void 0===n)n=e;else try{n=(0,c.xW)(n,e)}catch{n=void 0,s=!1}}catch(e){throw await(l?.handleChainError(e,void 0,void 0,void 0,{inputs:P(r,"input")})),e}await(l?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:P(r,"input")}))}getGraph(e){const t=new T,a=t.addNode({name:`${this.getName()}Input`,schema:r.z.any()}),n=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:r.z.any()});return t.addEdge(a,n),t.addEdge(n,i),t}pipe(e){return new L({first:this,last:U(e)})}pick(e){return this.pipe(new F(e))}assign(e){return this.pipe(new H(new M({steps:e})))}async*transform(e,t){let a;for await(const t of e)a=void 0===a?t:(0,c.xW)(a,t);yield*this._streamIterator(a,(0,g.ZI)(t))}async*streamLog(e,t,a){const r=new m({...a,autoClose:!1,_schemaFormat:"original"}),n=(0,g.ZI)(t);yield*this._streamLog(e,r,n)}async*_streamLog(e,t,a){const{callbacks:r}=a;if(void 0===r)a.callbacks=[t];else if(Array.isArray(r))a.callbacks=r.concat([t]);else{const e=r.copy();e.inheritableHandlers.push(t),a.callbacks=e}const n=this.stream(e,a),i=async function(){try{const e=await n;for await(const a of e){const e=new l({ops:[{op:"add",path:"/streamed_output/-",value:a}]});await t.writer.write(e)}}finally{await t.writer.close()}}();try{for await(const e of t)yield e}finally{await i}}async*streamEvents(e,t,a){if("text/event-stream"===t.encoding){const r=await this._streamEvents(e,t,a);yield*function(e){const t=new TextEncoder,a=new ReadableStream({async start(a){for await(const r of e)a.enqueue(t.encode(`event: data\ndata: ${JSON.stringify(r)}\n\n`));a.enqueue(t.encode("event: end\n\n")),a.close()}});return c.bO.fromReadableStream(a)}(r)}else yield*this._streamEvents(e,t,a)}async*_streamEvents(e,t,a){if("v1"!==t.version)throw new Error('Only version "v1" of the events schema is currently supported.');let r,n=!1;const i=(0,g.ZI)(t),s=i.tags??[],o=i.metadata??{},c=i.runName??this.getName(),d=new m({...a,autoClose:!1,_schemaFormat:"streaming_events"}),l=new b({...a}),h=this._streamLog(e,d,i);for await(const t of h){if(r=r?r.concat(t):u.fromRunLogPatch(t),void 0===r.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!n){n=!0;const t={...r.state},a={run_id:t.id,event:`on_${t.type}_start`,name:c,tags:s,metadata:o,data:{input:e}};l.includeEvent(a,t.type)&&(yield a)}const a=t.ops.filter((e=>e.path.startsWith("/logs/"))).map((e=>e.path.split("/")[2])),i=[...new Set(a)];for(const e of i){let t,a={};const n=r.state.logs[e];if(t=void 0===n.end_time?n.streamed_output.length>0?"stream":"start":"end","start"===t)void 0!==n.inputs&&(a.input=n.inputs);else if("end"===t)void 0!==n.inputs&&(a.input=n.inputs),a.output=n.final_output;else if("stream"===t){const e=n.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${n.name}"`);a={chunk:n.streamed_output[0]},n.streamed_output=[]}yield{event:`on_${n.type}_${t}`,name:n.name,run_id:n.id,tags:n.tags,metadata:n.metadata,data:a}}const{state:d}=r;if(d.streamed_output.length>0){const e=d.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${d.name}"`);const t={chunk:d.streamed_output[0]};d.streamed_output=[];const a={event:`on_${d.type}_stream`,run_id:d.id,tags:s,metadata:o,name:c,data:t};l.includeEvent(a,d.type)&&(yield a)}}const p=r?.state;if(void 0!==p){const e={event:`on_${p.type}_end`,name:c,run_id:p.id,tags:s,metadata:o,data:{output:p.final_output}};l.includeEvent(e,p.type)&&(yield e)}}static isRunnable(e){return v(e)}withListeners({onStart:e,onEnd:t,onError:a}){return new C({bound:this,config:{},configFactories:[r=>({callbacks:[new _({config:r,onStart:e,onEnd:t,onError:a})]})]})}}class C extends A{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=(0,g.SV)(this.config,...e);return(0,g.SV)(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig((0,g.ZI)(t),this.kwargs))}async batch(e,t,a){const r=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig((0,g.ZI)(e),this.kwargs)))):await this._mergeConfig((0,g.ZI)(t),this.kwargs);return this.bound.batch(e,r,a)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig((0,g.ZI)(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig((0,g.ZI)(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig((0,g.ZI)(t),this.kwargs))}async*streamEvents(e,t,a){yield*this.bound.streamEvents(e,{...await this._mergeConfig((0,g.ZI)(t),this.kwargs),version:t.version},a)}static isRunnableBinding(e){return e.bound&&A.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:a}){return new C({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[r=>({callbacks:[new _({config:r,onStart:e,onEnd:t,onError:a})]})]})}}class R extends A{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new R({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,a){return this.bound.batch(e,(0,g.tn)(t,{callbacks:a?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:a}){return new R({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:a})})}}class $ extends C{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,a){const r=e>1?`retry:attempt:${e}`:void 0;return(0,g.tn)(t,{callbacks:a?.getChild(r)})}async _invoke(e,t,a){return n((r=>super.invoke(e,this._patchConfigForRetry(r,t,a))),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,a,r){const i={};try{await n((async n=>{const s=e.map(((e,t)=>t)).filter((e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error)),o=s.map((t=>e[t])),c=s.map((e=>this._patchConfigForRetry(n,t?.[e],a?.[e]))),d=await super.batch(o,c,{...r,returnExceptions:!0});let l;for(let e=0;e<d.length;e+=1){const t=d[e],a=s[e];t instanceof Error&&void 0===l&&(l=t,l.input=o[e]),i[a.toString()]=t}if(l)throw l;return d}),{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==r?.returnExceptions)throw e}return Object.keys(i).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>i[parseInt(e,10)]))}async batch(e,t,a){return this._batchWithConfig(this._batch.bind(this),e,t,a)}}class L extends A{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const a=(0,g.ZI)(t),r=await(0,g.kJ)(a),n=await(r?.handleChainStart(this.toJSON(),P(e,"input"),a.runId,void 0,void 0,void 0,a?.runName));delete a.runId;let i,s=e;try{const e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){const r=e[t];s=await r.invoke(s,(0,g.tn)(a,{callbacks:n?.getChild(`seq:step:${t+1}`)}))}i=await this.last.invoke(s,(0,g.tn)(a,{callbacks:n?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await(n?.handleChainError(e)),e}return await(n?.handleChainEnd(P(i,"output"))),i}async batch(e,t,a){const r=this._getOptionsList(t??{},e.length),n=await Promise.all(r.map(g.kJ)),i=await Promise.all(n.map((async(t,a)=>{const n=await(t?.handleChainStart(this.toJSON(),P(e[a],"input"),r[a].runId,void 0,void 0,void 0,r[a].runName));return delete r[a].runId,n})));let s=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e];s=await t.batch(s,i.map(((t,a)=>{const n=t?.getChild(`seq:step:${e+1}`);return(0,g.tn)(r[a],{callbacks:n})})),a)}}catch(e){throw await Promise.all(i.map((t=>t?.handleChainError(e)))),e}return await Promise.all(i.map((e=>e?.handleChainEnd(P(s,"output"))))),s}async*_streamIterator(e,t){const a=await(0,g.kJ)(t),{runId:r,...n}=t??{},i=await(a?.handleChainStart(this.toJSON(),P(e,"input"),r,void 0,void 0,void 0,n?.runName)),s=[this.first,...this.middle,this.last];let o,d=!0;try{let t=s[0].transform(async function*(){yield e}(),(0,g.tn)(n,{callbacks:i?.getChild("seq:step:1")}));for(let e=1;e<s.length;e+=1){const a=s[e];t=await a.transform(t,(0,g.tn)(n,{callbacks:i?.getChild(`seq:step:${e+1}`)}))}for await(const e of t)if(yield e,d)if(void 0===o)o=e;else try{o=(0,c.xW)(o,e)}catch(e){o=void 0,d=!1}}catch(e){throw await(i?.handleChainError(e)),e}await(i?.handleChainEnd(P(o,"output")))}getGraph(e){const t=new T;let a=null;return this.steps.forEach(((r,n)=>{const i=r.getGraph(e);0!==n&&i.trimFirstNode(),n!==this.steps.length-1&&i.trimLastNode(),t.extend(i);const s=i.firstNode();if(!s)throw new Error(`Runnable ${r} has no first node`);a&&t.addEdge(a,s),a=i.lastNode()})),t}pipe(e){return L.isRunnableSequence(e)?new L({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new L({first:this.first,middle:[...this.middle,this.last],last:U(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&A.isRunnable(e)}static from([e,...t],a){return new L({first:U(e),middle:t.slice(0,-1).map(U),last:U(t[t.length-1]),name:a})}}class M extends A{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,a]of Object.entries(e.steps))this.steps[t]=U(a)}static from(e){return new M({steps:e})}async invoke(e,t){const a=(0,g.ZI)(t),r=await(0,g.kJ)(a),n=await(r?.handleChainStart(this.toJSON(),{input:e},a.runId,void 0,void 0,void 0,a?.runName));delete a.runId;const i={};try{await Promise.all(Object.entries(this.steps).map((async([t,r])=>{i[t]=await r.invoke(e,(0,g.tn)(a,{callbacks:n?.getChild(`map:key:${t}`)}))})))}catch(e){throw await(n?.handleChainError(e)),e}return await(n?.handleChainEnd(i)),i}async*_transform(e,t,a){const r={...this.steps},n=(0,c.gI)(e,Object.keys(r).length),i=new Map(Object.entries(r).map((([e,r],i)=>{const s=r.transform(n[i],(0,g.tn)(a,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then((t=>({key:e,gen:s,result:t})))]})));for(;i.size;){const{key:e,result:t,gen:a}=await Promise.race(i.values());i.delete(e),t.done||(yield{[e]:t.value},i.set(e,a.next().then((t=>({key:e,gen:a,result:t})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const a=new c.Tr(this.transform(async function*(){yield e}(),t));return await a.setup,c.bO.fromAsyncGenerator(a)}}class Z extends A{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new Z({func:e})}async _invoke(e,t,a){return new Promise(((r,n)=>{const i=(0,g.tn)(t,{callbacks:a?.getChild(),recursionLimit:(t?.recursionLimit??g.p_)-1});w.N.getInstance().run(i,(async()=>{try{let a=await this.func(e,{...i,config:i});if(a&&A.isRunnable(a)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");a=await a.invoke(e,{...i,recursionLimit:(i.recursionLimit??g.p_)-1})}else if(S(a)){let e;for await(const t of N(i,a))if(void 0===e)e=t;else try{e=(0,c.xW)(e,t)}catch(a){e=t}a=e}else if(I(a)){let e;for(const t of j(i,a))if(void 0===e)e=t;else try{e=(0,c.xW)(e,t)}catch(a){e=t}a=e}r(a)}catch(e){n(e)}}))}))}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,a){let r;for await(const t of e)if(void 0===r)r=t;else try{r=(0,c.xW)(r,t)}catch(e){r=t}const n=await new Promise(((e,t)=>{w.N.getInstance().run(a,(async()=>{try{const t=await this.func(r,{...a,config:a});e(t)}catch(e){t(e)}}))}));if(n&&A.isRunnable(n)){if(0===a?.recursionLimit)throw new Error("Recursion limit reached.");const e=await n.stream(r,(0,g.tn)(a,{callbacks:t?.getChild(),recursionLimit:(a?.recursionLimit??g.p_)-1}));for await(const t of e)yield t}else if(S(n))for await(const e of N(a,n))yield e;else if(I(n))for(const e of j(a,n))yield e;else yield n}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const a=new c.Tr(this.transform(async function*(){yield e}(),t));return await a.setup,c.bO.fromAsyncGenerator(a)}}class D extends A{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const a=await i.Td.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),{runId:r,...n}=t??{},s=await(a?.handleChainStart(this.toJSON(),P(e,"input"),r,void 0,void 0,void 0,n?.runName));let o;for(const t of this.runnables())try{const a=await t.invoke(e,(0,g.tn)(n,{callbacks:s?.getChild()}));return await(s?.handleChainEnd(P(a,"output"))),a}catch(e){void 0===o&&(o=e)}if(void 0===o)throw new Error("No error stored at end of fallback.");throw await(s?.handleChainError(o)),o}async batch(e,t,a){if(a?.returnExceptions)throw new Error("Not implemented.");const r=this._getOptionsList(t??{},e.length),n=await Promise.all(r.map((e=>i.Td.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),s=await Promise.all(n.map((async(t,a)=>{const n=await(t?.handleChainStart(this.toJSON(),P(e[a],"input"),r[a].runId,void 0,void 0,void 0,r[a].runName));return delete r[a].runId,n})));let o;for(const t of this.runnables())try{const n=await t.batch(e,s.map(((e,t)=>(0,g.tn)(r[t],{callbacks:e?.getChild()}))),a);return await Promise.all(s.map(((e,t)=>e?.handleChainEnd(P(n[t],"output"))))),n}catch(e){void 0===o&&(o=e)}if(!o)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(s.map((e=>e?.handleChainError(o)))),o}}function U(e){if("function"==typeof e)return new Z({func:e});if(A.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[a,r]of Object.entries(e))t[a]=U(r);return new M({steps:t})}}class H extends A{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof M&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const a=await this.mapper.invoke(e,t);return{...e,...a}}async*_transform(e,t,a){const r=this.mapper.getStepsKeys(),[n,i]=(0,c.gI)(e),s=this.mapper.transform(i,(0,g.tn)(a,{callbacks:t?.getChild()})),o=s.next();for await(const e of n){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!r.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of s)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const a=new c.Tr(this.transform(async function*(){yield e}(),t));return await a.setup,c.bO.fromAsyncGenerator(a)}}class F extends A{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const a=new c.Tr(this.transform(async function*(){yield e}(),t));return await a.setup,c.bO.fromAsyncGenerator(a)}}},49868:(e,t,a)=>{a.d(t,{SV:()=>o,ZI:()=>d,kJ:()=>s,p_:()=>i,tn:()=>l});var r=a(7459),n=a(3232);const i=25;async function s(e){return r.Td.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function o(...e){const t={};for(const a of e.filter((e=>!!e)))for(const e of Object.keys(a))if("metadata"===e)t[e]={...t[e],...a[e]};else if("tags"===e){const r=t[e]??[];t[e]=[...new Set(r.concat(a[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...a[e]};else if("callbacks"===e){const e=t.callbacks,n=a.callbacks;if(Array.isArray(n))if(e)if(Array.isArray(e))t.callbacks=e.concat(n);else{const a=e.copy();for(const e of n)a.addHandler((0,r.tW)(e),!0);t.callbacks=a}else t.callbacks=n;else if(n)if(e)if(Array.isArray(e)){const a=n.copy();for(const t of e)a.addHandler((0,r.tW)(t),!0);t.callbacks=a}else t.callbacks=new r.Td(n._parentRunId,{handlers:e.handlers.concat(n.handlers),inheritableHandlers:e.inheritableHandlers.concat(n.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(n.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(n.inheritableTags))),metadata:{...e.metadata,...n.metadata}});else t.callbacks=n}else{const r=e;t[r]=a[r]??t[r]}return t}const c=new Set(["string","number","boolean"]);function d(e){const t=e??n.N.getInstance().getStore();let a={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(t&&(a={...a,...t}),t?.configurable)for(const e of Object.keys(t.configurable))c.has(typeof t.configurable[e])&&!a.metadata?.[e]&&(a.metadata||(a.metadata={}),a.metadata[e]=t.configurable[e]);return a}function l(e={},{callbacks:t,maxConcurrency:a,recursionLimit:r,runName:n,configurable:i,runId:s}={}){const o=d(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==r&&(o.recursionLimit=r),void 0!==a&&(o.maxConcurrency=a),void 0!==n&&(o.runName=n),void 0!==i&&(o.configurable={...o.configurable,...i}),void 0!==s&&delete o.runId,o}},3232:(e,t,a)=>{a.d(t,{N:()=>n});class r{getStore(){}run(e,t){return t()}}const n=new class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new r}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}}},67499:(e,t,a)=>{a.d(t,{J:()=>i});var r=a(43405);function n(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class i extends r.N{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`\n\n${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){const t=function(e,t,a){const r=a.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${r}Z`.replace(/[-:.]/g,"")+t}(e.start_time,e.id,e.execution_order),a={...e};if(void 0!==a.parent_run_id){const e=this.runMap.get(a.parent_run_id);e&&(this._addChildRun(e,a),e.child_execution_order=Math.max(e.child_execution_order,a.child_execution_order),a.trace_id=e.trace_id,void 0!==e.dotted_order&&(a.dotted_order=[e.dotted_order,t].join(".")))}else a.trace_id=a.id,a.dotted_order=t;this.runMap.set(a.id,a),await(this.onRunCreate?.(a))}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,a,r,n,i,s,o){const c=this._getExecutionOrder(r),d=Date.now(),l=s?{...n,metadata:s}:n,u={id:a,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:i||[]};return await this._startTrace(u),await(this.onLLMStart?.(u)),u}async handleChatModelStart(e,t,a,r,n,i,s,o){const c=this._getExecutionOrder(r),d=Date.now(),l=s?{...n,metadata:s}:n,u={id:a,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:i||[]};return await this._startTrace(u),await(this.onLLMStart?.(u)),u}async handleLLMEnd(e,t){const a=this.runMap.get(t);if(!a||"llm"!==a?.run_type)throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),await(this.onLLMEnd?.(a)),await this._endTrace(a),a}async handleLLMError(e,t){const a=this.runMap.get(t);if(!a||"llm"!==a?.run_type)throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),await(this.onLLMError?.(a)),await this._endTrace(a),a}async handleChainStart(e,t,a,r,n,i,s,o){const c=this._getExecutionOrder(r),d=Date.now(),l={id:a,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(l),await(this.onChainStart?.(l)),l}async handleChainEnd(e,t,a,r,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=n(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=n(i.inputs,"input")),await(this.onChainEnd?.(s)),await this._endTrace(s),s}async handleChainError(e,t,a,r,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=n(i.inputs,"input")),await(this.onChainError?.(s)),await this._endTrace(s),s}async handleToolStart(e,t,a,r,n,i,s){const o=this._getExecutionOrder(r),c=Date.now(),d={id:a,name:s??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(d),await(this.onToolStart?.(d)),d}async handleToolEnd(e,t){const a=this.runMap.get(t);if(!a||"tool"!==a?.run_type)throw new Error("No tool run to end");return a.end_time=Date.now(),a.outputs={output:e},a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),await(this.onToolEnd?.(a)),await this._endTrace(a),a}async handleToolError(e,t){const a=this.runMap.get(t);if(!a||"tool"!==a?.run_type)throw new Error("No tool run to end");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),await(this.onToolError?.(a)),await this._endTrace(a),a}async handleAgentAction(e,t){const a=this.runMap.get(t);if(!a||"chain"!==a?.run_type)return;const r=a;r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(a))}async handleAgentEnd(e,t){const a=this.runMap.get(t);a&&"chain"===a?.run_type&&(a.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(a)))}async handleRetrieverStart(e,t,a,r,n,i,s){const o=this._getExecutionOrder(r),c=Date.now(),d={id:a,name:s??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(d),await(this.onRetrieverStart?.(d)),d}async handleRetrieverEnd(e,t){const a=this.runMap.get(t);if(!a||"retriever"!==a?.run_type)throw new Error("No retriever run to end");return a.end_time=Date.now(),a.outputs={documents:e},a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),await(this.onRetrieverEnd?.(a)),await this._endTrace(a),a}async handleRetrieverError(e,t){const a=this.runMap.get(t);if(!a||"retriever"!==a?.run_type)throw new Error("No retriever run to end");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),await(this.onRetrieverError?.(a)),await this._endTrace(a),a}async handleText(e,t){const a=this.runMap.get(t);a&&"chain"===a?.run_type&&(a.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(a)))}async handleLLMNewToken(e,t,a,r,n,i){const s=this.runMap.get(a);if(!s||"llm"!==s?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await(this.onLLMNewToken?.(s,e,{chunk:i?.chunk})),s}}},3817:(e,t,a)=>{a.d(t,{g:()=>o});var r=a(26742),n=a(12425);const i=[400,401,402,403,404,405,406,407,409],s=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&i.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??s;const t=n.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>r((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...a){return e.signal?Promise.race([this.call(t,...a),new Promise(((t,a)=>{e.signal?.addEventListener("abort",(()=>{a(new Error("AbortError"))}))}))]):this.call(t,...a)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},5260:(e,t,a)=>{a.d(t,{Az:()=>o,Ec:()=>s});const r=()=>"undefined"!=typeof Deno,n=()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||r()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":r()?"deno":"other":"node",e};let i;async function s(){if(void 0===i){const e=n();i={library:"langchain-js",runtime:e}}return i}function o(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}},28431:(e,t,a)=>{a.d(t,{X6:()=>v,UD:()=>E});var r={};a.r(r),a.d(r,{JsonPatchError:()=>p,_areEquals:()=>O,applyOperation:()=>_,applyPatch:()=>v,applyReducer:()=>b,deepClone:()=>m,getValueByPointer:()=>y,validate:()=>k,validator:()=>w});const n=Object.prototype.hasOwnProperty;function i(e,t){return n.call(e,t)}function s(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let a in e)i(e,a)&&t.push(a);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function c(e){let t=0;const a=e.length;let r;for(;t<a;){if(r=e.charCodeAt(t),!(r>=48&&r<=57))return!1;t++}return!0}function d(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function l(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,a=e.length;t<a;t++)if(l(e[t]))return!0}else if("object"==typeof e){const a=s(e),r=a.length;for(var t=0;t<r;t++)if(l(e[a[t]]))return!0}return!1}function u(e,t){const a=[e];for(const e in t){const r="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==r&&a.push(`${e}: ${r}`)}return a.join("\n")}class h extends Error{constructor(e,t,a,r,n){super(u(e,{name:t,index:a,operation:r,tree:n})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.setPrototypeOf(this,new.target.prototype),this.message=u(e,{name:t,index:a,operation:r,tree:n})}}const p=h,m=o,f={add:function(e,t,a){return e[t]=this.value,{newDocument:a}},remove:function(e,t,a){var r=e[t];return delete e[t],{newDocument:a,removed:r}},replace:function(e,t,a){var r=e[t];return e[t]=this.value,{newDocument:a,removed:r}},move:function(e,t,a){let r=y(a,this.path);r&&(r=o(r));const n=_(a,{op:"remove",path:this.from}).removed;return _(a,{op:"add",path:this.path,value:n}),{newDocument:a,removed:r}},copy:function(e,t,a){const r=y(a,this.from);return _(a,{op:"add",path:this.path,value:o(r)}),{newDocument:a}},test:function(e,t,a){return{newDocument:a,test:O(e[t],this.value)}},_get:function(e,t,a){return this.value=e[t],{newDocument:a}}};var g={add:function(e,t,a){return c(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:a,index:t}},remove:function(e,t,a){return{newDocument:a,removed:e.splice(t,1)[0]}},replace:function(e,t,a){var r=e[t];return e[t]=this.value,{newDocument:a,removed:r}},move:f.move,copy:f.copy,test:f.test,_get:f._get};function y(e,t){if(""==t)return e;var a={op:"_get",path:t};return _(e,a),a.value}function _(e,t,a=!1,r=!0,n=!0,i=0){if(a&&("function"==typeof a?a(t,0,e,t.path):w(t,0)),""===t.path){let r={newDocument:e};if("add"===t.op)return r.newDocument=t.value,r;if("replace"===t.op)return r.newDocument=t.value,r.removed=e,r;if("move"===t.op||"copy"===t.op)return r.newDocument=y(e,t.from),"move"===t.op&&(r.removed=e),r;if("test"===t.op){if(r.test=O(e,t.value),!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return r.newDocument=e,r}if("remove"===t.op)return r.removed=e,r.newDocument=null,r;if("_get"===t.op)return t.value=e,r;if(a)throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return r}{r||(e=o(e));const s=(t.path||"").split("/");let d,l,u,h=e,m=1,y=s.length;for(u="function"==typeof a?a:w;;){if(l=s[m],l&&-1!=l.indexOf("~")&&(l=l.replace(/~1/g,"/").replace(/~0/g,"~")),n&&("__proto__"==l||"prototype"==l&&m>0&&"constructor"==s[m-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(a&&void 0===d&&(void 0===h[l]?d=s.slice(0,m).join("/"):m==y-1&&(d=t.path),void 0!==d&&u(t,0,e,d)),m++,Array.isArray(h)){if("-"===l)l=h.length;else{if(a&&!c(l))throw new p("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);c(l)&&(l=~~l)}if(m>=y){if(a&&"add"===t.op&&l>h.length)throw new p("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);const r=g[t.op].call(t,h,l,e);if(!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return r}}else if(m>=y){const a=f[t.op].call(t,h,l,e);if(!1===a.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a}if(h=h[l],a&&m<y&&(!h||"object"!=typeof h))throw new p("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}}function v(e,t,a,r=!0,n=!0){if(a&&!Array.isArray(t))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=o(e));const i=new Array(t.length);for(let r=0,s=t.length;r<s;r++)i[r]=_(e,t[r],a,!0,n,r),e=i[r].newDocument;return i.newDocument=e,i}function b(e,t,a){const r=_(e,t);if(!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r.newDocument}function w(e,t,a,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new p("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,a);if(!f[e.op])throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,a);if("string"!=typeof e.path)throw new p("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,a);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new p('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,a);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new p("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,a);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,a);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&l(e.value))throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,a);if(a)if("add"==e.op){var n=e.path.split("/").length,i=r.split("/").length;if(n!==i+1&&n!==i)throw new p("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,a)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new p("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,a)}else if("move"===e.op||"copy"===e.op){var s=k([{op:"_get",path:e.from,value:void 0}],a);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new p("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,a)}}function k(e,t,a){try{if(!Array.isArray(e))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)v(o(t),o(e),a||!0);else{a=a||w;for(var r=0;r<e.length;r++)a(e[r],r,t,void 0)}}catch(e){if(e instanceof p)return e;throw e}}function O(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var a,r,n,i=Array.isArray(e),s=Array.isArray(t);if(i&&s){if((r=e.length)!=t.length)return!1;for(a=r;0!=a--;)if(!O(e[a],t[a]))return!1;return!0}if(i!=s)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(a=r;0!=a--;)if(!t.hasOwnProperty(o[a]))return!1;for(a=r;0!=a--;)if(!O(e[n=o[a]],t[n]))return!1;return!0}return e!=e&&t!=t}function x(e,t,a,r,n){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var c=s(t),l=s(e),u=!1,h=l.length-1;h>=0;h--){var p=e[f=l[h]];if(!i(t,f)||void 0===t[f]&&void 0!==p&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(n&&a.push({op:"test",path:r+"/"+d(f),value:o(p)}),a.push({op:"remove",path:r+"/"+d(f)}),u=!0):(n&&a.push({op:"test",path:r,value:e}),a.push({op:"replace",path:r,value:t}));else{var m=t[f];"object"==typeof p&&null!=p&&"object"==typeof m&&null!=m&&Array.isArray(p)===Array.isArray(m)?x(p,m,a,r+"/"+d(f),n):p!==m&&(n&&a.push({op:"test",path:r+"/"+d(f),value:o(p)}),a.push({op:"replace",path:r+"/"+d(f),value:o(m)}))}}if(u||c.length!=l.length)for(h=0;h<c.length;h++){var f;i(e,f=c[h])||void 0===t[f]||a.push({op:"add",path:r+"/"+d(f),value:o(t[f])})}}}function E(e,t,a=!1){var r=[];return x(e,t,r,"",a),r}new WeakMap},64293:(e,t,a)=>{function r(e,t=n){e=e.trim();const a=/```(json)?(.*)```/s.exec(e);return t(a?a[2]:e)}function n(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="";const a=[];let r=!1,n=!1;for(let i of e){if(r)'"'!==i||n?"\n"!==i||n?n="\\"===i&&!n:i="\\n":r=!1;else if('"'===i)r=!0,n=!1;else if("{"===i)a.push("}");else if("["===i)a.push("]");else if("}"===i||"]"===i){if(!a||a[a.length-1]!==i)return null;a.pop()}t+=i}r&&(t+='"');for(let e=a.length-1;e>=0;e-=1)t+=a[e];try{return JSON.parse(t)}catch(e){return null}}a.d(t,{D:()=>r,d:()=>n})},24231:(e,t,a)=>{a.d(t,{DS:()=>o,Tr:()=>s,bO:()=>r,gI:()=>n,xW:()=>i});class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new r({start:e=>function a(){return t.read().then((({done:t,value:r})=>{if(!t)return e.enqueue(r),a();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({async pull(t){const{value:a,done:r}=await e.next();r&&t.close(),t.enqueue(a)},async cancel(t){await e.return(t)}})}}function n(e,t=2){const a=Array.from({length:t},(()=>[]));return a.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of a)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))}function i(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const a={...e};for(const[e,r]of Object.entries(t))e in a&&!Array.isArray(a[e])?a[e]=i(a[e],r):a[e]=r;return a}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class s{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise(((a,r)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(a,r):this.firstResult.then((e=>a(void 0)),r)}))}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}async function o(e,t,a,...r){const n=new s(t,a),i=await n.setup;return{output:e(n,i,...r),setup:i}}},63177:(e,t,a)=>{a.d(t,{Ik:()=>E});const r=Symbol("Let zodToJsonSchema decide on which parser to use"),n={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};var i=a(68576);function s(e,t,a,r){r?.errorMessages&&a&&(e.errorMessage={...e.errorMessage,[t]:a})}function o(e,t,a,r,n){e[t]=a,s(e,t,r,n)}function c(e,t,a){const r=a??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map(((a,r)=>c(e,t,a)))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return d(e,t)}}const d=(e,t)=>{const a={type:"integer",format:"unix-time"};if("openApi3"===t.target)return a;for(const r of e.checks)switch(r.kind){case"min":o(a,"minimum",r.value,r.message,t);break;case"max":o(a,"maximum",r.value,r.message,t)}return a},l={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u"),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function u(e,t){const a={type:"string"};function r(e){return"escape"===t.patternStrategy?h(e):e}if(e.checks)for(const n of e.checks)switch(n.kind){case"min":o(a,"minLength","number"==typeof a.minLength?Math.max(a.minLength,n.value):n.value,n.message,t);break;case"max":o(a,"maxLength","number"==typeof a.maxLength?Math.min(a.maxLength,n.value):n.value,n.message,t);break;case"email":switch(t.emailStrategy){case"format:email":p(a,"email",n.message,t);break;case"format:idn-email":p(a,"idn-email",n.message,t);break;case"pattern:zod":m(a,l.email,n.message,t)}break;case"url":p(a,"uri",n.message,t);break;case"uuid":p(a,"uuid",n.message,t);break;case"regex":m(a,n.regex,n.message,t);break;case"cuid":m(a,l.cuid,n.message,t);break;case"cuid2":m(a,l.cuid2,n.message,t);break;case"startsWith":m(a,RegExp(`^${r(n.value)}`),n.message,t);break;case"endsWith":m(a,RegExp(`${r(n.value)}$`),n.message,t);break;case"datetime":p(a,"date-time",n.message,t);break;case"date":p(a,"date",n.message,t);break;case"time":p(a,"time",n.message,t);break;case"duration":p(a,"duration",n.message,t);break;case"length":o(a,"minLength","number"==typeof a.minLength?Math.max(a.minLength,n.value):n.value,n.message,t),o(a,"maxLength","number"==typeof a.maxLength?Math.min(a.maxLength,n.value):n.value,n.message,t);break;case"includes":m(a,RegExp(r(n.value)),n.message,t);break;case"ip":"v6"!==n.version&&p(a,"ipv4",n.message,t),"v4"!==n.version&&p(a,"ipv6",n.message,t);break;case"emoji":m(a,l.emoji,n.message,t);break;case"ulid":m(a,l.ulid,n.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":p(a,"binary",n.message,t);break;case"contentEncoding:base64":o(a,"contentEncoding","base64",n.message,t);break;case"pattern:zod":m(a,l.base64,n.message,t)}break;case"nanoid":m(a,l.nanoid,n.message,t)}return a}const h=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),p=(e,t,a,r)=>{e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...a&&r.errorMessages&&{errorMessage:{format:a}}})):o(e,"format",t,a,r)},m=(e,t,a,r)=>{e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:f(t,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):o(e,"pattern",f(t,r),a,r)},f=(e,t)=>{if(!t.applyRegexFlags||!e.flags)return e.source;const a=e.flags.includes("i"),r=e.flags.includes("m"),n=e.flags.includes("s"),i=a?e.source.toLowerCase():e.source;let s="",o=!1,c=!1,d=!1;for(let e=0;e<i.length;e++)if(o)s+=i[e],o=!1;else{if(a)if(c){if(i[e].match(/[a-z]/)){d?(s+=i[e],s+=`${i[e-2]}-${i[e]}`.toUpperCase(),d=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(s+=i[e],d=!0):s+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){s+=`[${i[e]}${i[e].toUpperCase()}]`;continue}if(r){if("^"===i[e]){s+="(^|(?<=[\r\n]))";continue}if("$"===i[e]){s+="($|(?=[\r\n]))";continue}}n&&"."===i[e]?s+=c?`${i[e]}\r\n`:`[${i[e]}\r\n]`:(s+=i[e],"\\"===i[e]?o=!0:c&&"]"===i[e]?c=!1:c||"["!==i[e]||(c=!0))}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s};function g(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===i.kY.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((a,r)=>({...a,[r]:b(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??{}})),{}),additionalProperties:!1};const a={type:"object",additionalProperties:b(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return a;if(e.keyType?._def.typeName===i.kY.ZodString&&e.keyType._def.checks?.length){const r=Object.entries(u(e.keyType._def,t)).reduce(((e,[t,a])=>"type"===t?e:{...e,[t]:a}),{});return{...a,propertyNames:r}}return e.keyType?._def.typeName===i.kY.ZodEnum?{...a,propertyNames:{enum:e.keyType._def.values}}:a}const y={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},_=(e,t)=>{const a=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,a)=>b(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return a.length?{anyOf:a}:void 0};function v(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:b(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:b(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function b(e,t,a=!1){const n=t.seen.get(e);if(t.override){const i=t.override?.(e,t,n,a);if(i!==r)return i}if(n&&!a){const e=w(n,t);if(void 0!==e)return e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const s=O(e,e.typeName,t);return s&&x(e,t,s),i.jsonSchema=s,s}const w=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:k(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,a)=>t.currentPath[a]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},k=(e,t)=>{let a=0;for(;a<e.length&&a<t.length&&e[a]===t[a];a++);return[(e.length-a).toString(),...t.slice(a)].join("/")},O=(e,t,a)=>{switch(t){case i.kY.ZodString:return u(e,a);case i.kY.ZodNumber:return function(e,t){const a={type:"number"};if(!e.checks)return a;for(const r of e.checks)switch(r.kind){case"int":a.type="integer",s(a,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?o(a,"minimum",r.value,r.message,t):o(a,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(a.exclusiveMinimum=!0),o(a,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?o(a,"maximum",r.value,r.message,t):o(a,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(a.exclusiveMaximum=!0),o(a,"maximum",r.value,r.message,t));break;case"multipleOf":o(a,"multipleOf",r.value,r.message,t)}return a}(e,a);case i.kY.ZodObject:return function(e,t){const a={type:"object",...Object.entries(e.shape()).reduce(((e,[a,r])=>{if(void 0===r||void 0===r._def)return e;const n=b(r._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return void 0===n?e:{properties:{...e.properties,[a]:n},required:r.isOptional()?e.required:[...e.required,a]}}),{properties:{},required:[]}),additionalProperties:v(e,t)};return a.required.length||delete a.required,a}(e,a);case i.kY.ZodBigInt:return function(e,t){const a={type:"integer",format:"int64"};if(!e.checks)return a;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?o(a,"minimum",r.value,r.message,t):o(a,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(a.exclusiveMinimum=!0),o(a,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?o(a,"maximum",r.value,r.message,t):o(a,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(a.exclusiveMaximum=!0),o(a,"maximum",r.value,r.message,t));break;case"multipleOf":o(a,"multipleOf",r.value,r.message,t)}return a}(e,a);case i.kY.ZodBoolean:return{type:"boolean"};case i.kY.ZodDate:return c(e,a);case i.kY.ZodUndefined:return{not:{}};case i.kY.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(a);case i.kY.ZodArray:return function(e,t){const a={type:"array"};return e.type?._def?.typeName!==i.kY.ZodAny&&(a.items=b(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&o(a,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&o(a,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(o(a,"minItems",e.exactLength.value,e.exactLength.message,t),o(a,"maxItems",e.exactLength.value,e.exactLength.message,t)),a}(e,a);case i.kY.ZodUnion:case i.kY.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return _(e,t);const a=e.options instanceof Map?Array.from(e.options.values()):e.options;if(a.every((e=>e._def.typeName in y&&(!e._def.checks||!e._def.checks.length)))){const e=a.reduce(((e,t)=>{const a=y[t._def.typeName];return a&&!e.includes(a)?[...e,a]:e}),[]);return{type:e.length>1?e:e[0]}}if(a.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=a.reduce(((e,t)=>{const a=typeof t._def.value;switch(a){case"string":case"number":case"boolean":return[...e,a];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===a.length){const t=e.filter(((e,t,a)=>a.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:a.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(a.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:a.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return _(e,t)}(e,a);case i.kY.ZodIntersection:return function(e,t){const a=[b(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),b(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const n=[];return a.forEach((e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:a,...r}=e;t=r}else r=void 0;n.push(t)}else n.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);var t})),n.length?{allOf:n,...r}:void 0}(e,a);case i.kY.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,a)=>b(e._def,{...t,currentPath:[...t.currentPath,"items",`${a}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:b(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,a)=>b(e._def,{...t,currentPath:[...t.currentPath,"items",`${a}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,a);case i.kY.ZodRecord:return g(e,a);case i.kY.ZodLiteral:return function(e,t){const a=typeof e.value;return"bigint"!==a&&"number"!==a&&"boolean"!==a&&"string"!==a?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===a?"integer":a,enum:[e.value]}:{type:"bigint"===a?"integer":a,const:e.value}}(e,a);case i.kY.ZodEnum:return function(e){return{type:"string",enum:e.values}}(e);case i.kY.ZodNativeEnum:return function(e){const t=e.values,a=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),r=Array.from(new Set(a.map((e=>typeof e))));return{type:1===r.length?"string"===r[0]?"string":"number":["string","number"],enum:a}}(e);case i.kY.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:y[e.innerType._def.typeName],nullable:!0}:{type:[y[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const a=b(e.innerType._def,{...t,currentPath:[...t.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}const a=b(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}(e,a);case i.kY.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return b(e.innerType._def,t);const a=b(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return a?{anyOf:[{not:{}},a]}:{}})(e,a);case i.kY.ZodMap:return function(e,t){return"record"===t.mapStrategy?g(e,t):{type:"array",maxItems:125,items:{type:"array",items:[b(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},b(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,a);case i.kY.ZodSet:return function(e,t){const a={type:"array",uniqueItems:!0,items:b(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&o(a,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&o(a,"maxItems",e.maxSize.value,e.maxSize.message,t),a}(e,a);case i.kY.ZodLazy:return b(e.getter()._def,a);case i.kY.ZodPromise:return function(e,t){return b(e.type._def,t)}(e,a);case i.kY.ZodNaN:case i.kY.ZodNever:return{not:{}};case i.kY.ZodEffects:return function(e,t){return"input"===t.effectStrategy?b(e.schema._def,t):{}}(e,a);case i.kY.ZodAny:case i.kY.ZodUnknown:return{};case i.kY.ZodDefault:return function(e,t){return{...b(e.innerType._def,t),default:e.defaultValue()}}(e,a);case i.kY.ZodBranded:return function(e,t){return b(e.type._def,t)}(e,a);case i.kY.ZodReadonly:case i.kY.ZodCatch:return((e,t)=>b(e.innerType._def,t))(e,a);case i.kY.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return b(e.in._def,t);if("output"===t.pipeStrategy)return b(e.out._def,t);const a=b(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[a,b(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",a?"1":"0"]})].filter((e=>void 0!==e))}})(e,a);case i.kY.ZodFunction:case i.kY.ZodVoid:case i.kY.ZodSymbol:default:return}},x=(e,t,a)=>(e.description&&(a.description=e.description,t.markdownDescription&&(a.markdownDescription=e.description)),a),E=(e,t)=>{const a=(e=>{const t=(e=>"string"==typeof e?{...n,name:e}:{...n,...e})(e),a=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t),r="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,r])=>({...e,[t]:b(r._def,{...a,currentPath:[...a.basePath,a.definitionPath,t]},!0)??{}})),{}):void 0,i="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,s=b(e._def,void 0===i?a:{...a,currentPath:[...a.basePath,a.definitionPath,i]},!1)??{},o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(s.title=o);const c=void 0===i?r?{...s,[a.definitionPath]:r}:s:{$ref:[..."relative"===a.$refStrategy?[]:a.basePath,a.definitionPath,i].join("/"),[a.definitionPath]:{...r,[i]:s}};return"jsonSchema7"===a.target?c.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===a.target&&(c.$schema="https://json-schema.org/draft/2019-09/schema#"),c}},68576:(e,t,a)=>{var r,n;a.d(t,{kY:()=>Le,z:()=>vt}),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const a of e)t[a]=a;return t},e.getValidEnumValues=t=>{const a=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),r={};for(const e of a)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.push(a);return t},e.find=(e,t)=>{for(const a of e)if(t(a))return a},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(r||(r={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(n||(n={}));const i=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),s=e=>{switch(typeof e){case"undefined":return i.undefined;case"string":return i.string;case"number":return isNaN(e)?i.nan:i.number;case"boolean":return i.boolean;case"function":return i.function;case"bigint":return i.bigint;case"symbol":return i.symbol;case"object":return Array.isArray(e)?i.array:null===e?i.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?i.promise:"undefined"!=typeof Map&&e instanceof Map?i.map:"undefined"!=typeof Set&&e instanceof Set?i.set:"undefined"!=typeof Date&&e instanceof Date?i.date:i.object;default:return i.unknown}},o=r.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class c extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},a={_errors:[]},r=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(r);else if("invalid_return_type"===n.code)r(n.returnTypeError);else if("invalid_arguments"===n.code)r(n.argumentsError);else if(0===n.path.length)a._errors.push(t(n));else{let e=a,r=0;for(;r<n.path.length;){const a=n.path[r];r===n.path.length-1?(e[a]=e[a]||{_errors:[]},e[a]._errors.push(t(n))):e[a]=e[a]||{_errors:[]},e=e[a],r++}}};return r(this),a}static assert(e){if(!(e instanceof c))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,r.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},a=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):a.push(e(r));return{formErrors:a,fieldErrors:t}}get formErrors(){return this.flatten()}}c.create=e=>new c(e);const d=(e,t)=>{let a;switch(e.code){case o.invalid_type:a=e.received===i.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case o.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(e.expected,r.jsonStringifyReplacer)}`;break;case o.unrecognized_keys:a=`Unrecognized key(s) in object: ${r.joinValues(e.keys,", ")}`;break;case o.invalid_union:a="Invalid input";break;case o.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${r.joinValues(e.options)}`;break;case o.invalid_enum_value:a=`Invalid enum value. Expected ${r.joinValues(e.options)}, received '${e.received}'`;break;case o.invalid_arguments:a="Invalid function arguments";break;case o.invalid_return_type:a="Invalid function return type";break;case o.invalid_date:a="Invalid date";break;case o.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(a=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(a=`${a} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?a=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?a=`Invalid input: must end with "${e.validation.endsWith}"`:r.assertNever(e.validation):a="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case o.too_small:a="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case o.too_big:a="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case o.custom:a="Invalid input";break;case o.invalid_intersection_types:a="Intersection results could not be merged";break;case o.not_multiple_of:a=`Number must be a multiple of ${e.multipleOf}`;break;case o.not_finite:a="Number must be finite";break;default:a=t.defaultError,r.assertNever(e)}return{message:a}};let l=d;function u(){return l}const h=e=>{const{data:t,path:a,errorMaps:r,issueData:n}=e,i=[...a,...n.path||[]],s={...n,path:i};if(void 0!==n.message)return{...n,path:i,message:n.message};let o="";const c=r.filter((e=>!!e)).slice().reverse();for(const e of c)o=e(s,{data:t,defaultError:o}).message;return{...n,path:i,message:o}};function p(e,t){const a=u(),r=h({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,a,a===d?void 0:d].filter((e=>!!e))});e.common.issues.push(r)}class m{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const a=[];for(const r of t){if("aborted"===r.status)return f;"dirty"===r.status&&e.dirty(),a.push(r.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,t){const a=[];for(const e of t){const t=await e.key,r=await e.value;a.push({key:t,value:r})}return m.mergeObjectSync(e,a)}static mergeObjectSync(e,t){const a={};for(const r of t){const{key:t,value:n}=r;if("aborted"===t.status)return f;if("aborted"===n.status)return f;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!r.alwaysSet||(a[t.value]=n.value)}return{status:e.value,value:a}}}const f=Object.freeze({status:"aborted"}),g=e=>({status:"dirty",value:e}),y=e=>({status:"valid",value:e}),_=e=>"aborted"===e.status,v=e=>"dirty"===e.status,b=e=>"valid"===e.status,w=e=>"undefined"!=typeof Promise&&e instanceof Promise;function k(e,t,a,r){if("a"===a&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===a?r:"a"===a?r.call(e):r?r.value:t.get(e)}function O(e,t,a,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,a):n?n.value=a:t.set(e,a),a}var x,E,T;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(x||(x={}));class I{constructor(e,t,a,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=a,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const S=(e,t)=>{if(b(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new c(e.common.issues);return this._error=t,this._error}}};function j(e){if(!e)return{};const{errorMap:t,invalid_type_error:a,required_error:r,description:n}=e;if(t&&(a||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{var i,s;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:n.defaultError}:void 0===n.data?{message:null!==(i=null!=o?o:r)&&void 0!==i?i:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(s=null!=o?o:a)&&void 0!==s?s:n.defaultError}},description:n}}class N{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return s(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:s(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new m,ctx:{common:e.parent.common,data:e.data,parsedType:s(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(w(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const a=this.safeParse(e,t);if(a.success)return a.data;throw a.error}safeParse(e,t){var a;const r={common:{issues:[],async:null!==(a=null==t?void 0:t.async)&&void 0!==a&&a,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:s(e)},n=this._parseSync({data:e,path:r.path,parent:r});return S(r,n)}async parseAsync(e,t){const a=await this.safeParseAsync(e,t);if(a.success)return a.data;throw a.error}async safeParseAsync(e,t){const a={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:s(e)},r=this._parse({data:e,path:a.path,parent:a}),n=await(w(r)?r:Promise.resolve(r));return S(a,n)}refine(e,t){const a=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const n=e(t),i=()=>r.addIssue({code:o.custom,...a(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then((e=>!!e||(i(),!1))):!!n||(i(),!1)}))}refinement(e,t){return this._refinement(((a,r)=>!!e(a)||(r.addIssue("function"==typeof t?t(a,r):t),!1)))}_refinement(e){return new xe({schema:this,typeName:Le.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Ee.create(this,this._def)}nullable(){return Te.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ie.create(this,this._def)}promise(){return Oe.create(this,this._def)}or(e){return ce.create([this,e],this._def)}and(e){return he.create(this,e,this._def)}transform(e){return new xe({...j(this._def),schema:this,typeName:Le.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Ie({...j(this._def),innerType:this,defaultValue:t,typeName:Le.ZodDefault})}brand(){return new Pe({typeName:Le.ZodBranded,type:this,...j(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Se({...j(this._def),innerType:this,catchValue:t,typeName:Le.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Ae.create(this,e)}readonly(){return Ce.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const P=/^c[^\s-]{8,}$/i,A=/^[0-9a-z]+$/,C=/^[0-9A-HJKMNP-TV-Z]{26}$/,R=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,$=/^[a-z0-9_-]{21}$/i,L=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,M=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Z;const D=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,U=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,H=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,F="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",B=new RegExp(`^${F}$`);function z(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function J(e){let t=`${F}T${z(e)}`;const a=[];return a.push(e.local?"Z?":"Z"),e.offset&&a.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${a.join("|")})`,new RegExp(`^${t}$`)}class V extends N{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==i.string){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.string,received:t.parsedType}),f}const t=new m;let a;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),p(a,{code:o.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("max"===i.kind)e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),p(a,{code:o.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("length"===i.kind){const r=e.data.length>i.value,n=e.data.length<i.value;(r||n)&&(a=this._getOrReturnCtx(e,a),r?p(a,{code:o.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):n&&p(a,{code:o.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),t.dirty())}else if("email"===i.kind)M.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"email",code:o.invalid_string,message:i.message}),t.dirty());else if("emoji"===i.kind)Z||(Z=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Z.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"emoji",code:o.invalid_string,message:i.message}),t.dirty());else if("uuid"===i.kind)R.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"uuid",code:o.invalid_string,message:i.message}),t.dirty());else if("nanoid"===i.kind)$.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"nanoid",code:o.invalid_string,message:i.message}),t.dirty());else if("cuid"===i.kind)P.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"cuid",code:o.invalid_string,message:i.message}),t.dirty());else if("cuid2"===i.kind)A.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"cuid2",code:o.invalid_string,message:i.message}),t.dirty());else if("ulid"===i.kind)C.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"ulid",code:o.invalid_string,message:i.message}),t.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(r){a=this._getOrReturnCtx(e,a),p(a,{validation:"url",code:o.invalid_string,message:i.message}),t.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"regex",code:o.invalid_string,message:i.message}),t.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),p(a,{code:o.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),t.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),p(a,{code:o.invalid_string,validation:{startsWith:i.value},message:i.message}),t.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),p(a,{code:o.invalid_string,validation:{endsWith:i.value},message:i.message}),t.dirty()):"datetime"===i.kind?J(i).test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{code:o.invalid_string,validation:"datetime",message:i.message}),t.dirty()):"date"===i.kind?B.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{code:o.invalid_string,validation:"date",message:i.message}),t.dirty()):"time"===i.kind?new RegExp(`^${z(i)}$`).test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{code:o.invalid_string,validation:"time",message:i.message}),t.dirty()):"duration"===i.kind?L.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"duration",code:o.invalid_string,message:i.message}),t.dirty()):"ip"===i.kind?(n=e.data,("v4"!==(s=i.version)&&s||!D.test(n))&&("v6"!==s&&s||!U.test(n))&&(a=this._getOrReturnCtx(e,a),p(a,{validation:"ip",code:o.invalid_string,message:i.message}),t.dirty())):"base64"===i.kind?H.test(e.data)||(a=this._getOrReturnCtx(e,a),p(a,{validation:"base64",code:o.invalid_string,message:i.message}),t.dirty()):r.assertNever(i);var n,s;return{status:t.value,value:e.data}}_regex(e,t,a){return this.refinement((t=>e.test(t)),{validation:t,code:o.invalid_string,...x.errToObj(a)})}_addCheck(e){return new V({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...x.errToObj(e)})}url(e){return this._addCheck({kind:"url",...x.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...x.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...x.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...x.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...x.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...x.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...x.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...x.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...x.errToObj(e)})}datetime(e){var t,a;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(a=null==e?void 0:e.local)&&void 0!==a&&a,...x.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...x.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...x.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...x.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...x.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...x.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...x.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...x.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...x.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...x.errToObj(t)})}nonempty(e){return this.min(1,x.errToObj(e))}trim(){return new V({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new V({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new V({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function G(e,t){const a=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,n=a>r?a:r;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}V.create=e=>{var t;return new V({checks:[],typeName:Le.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...j(e)})};class W extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==i.number){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.number,received:t.parsedType}),f}let t;const a=new m;for(const n of this._def.checks)"int"===n.kind?r.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),p(t,{code:o.invalid_type,expected:"integer",received:"float",message:n.message}),a.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),a.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),a.dirty()):"multipleOf"===n.kind?0!==G(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.not_multiple_of,multipleOf:n.value,message:n.message}),a.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),p(t,{code:o.not_finite,message:n.message}),a.dirty()):r.assertNever(n);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,x.toString(t))}gt(e,t){return this.setLimit("min",e,!1,x.toString(t))}lte(e,t){return this.setLimit("max",e,!0,x.toString(t))}lt(e,t){return this.setLimit("max",e,!1,x.toString(t))}setLimit(e,t,a,r){return new W({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:a,message:x.toString(r)}]})}_addCheck(e){return new W({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:x.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:x.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:x.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:x.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:x.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&r.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const a of this._def.checks){if("finite"===a.kind||"int"===a.kind||"multipleOf"===a.kind)return!0;"min"===a.kind?(null===t||a.value>t)&&(t=a.value):"max"===a.kind&&(null===e||a.value<e)&&(e=a.value)}return Number.isFinite(t)&&Number.isFinite(e)}}W.create=e=>new W({checks:[],typeName:Le.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...j(e)});class Y extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==i.bigint){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.bigint,received:t.parsedType}),f}let t;const a=new m;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),a.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),a.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.not_multiple_of,multipleOf:n.value,message:n.message}),a.dirty()):r.assertNever(n);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,x.toString(t))}gt(e,t){return this.setLimit("min",e,!1,x.toString(t))}lte(e,t){return this.setLimit("max",e,!0,x.toString(t))}lt(e,t){return this.setLimit("max",e,!1,x.toString(t))}setLimit(e,t,a,r){return new Y({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:a,message:x.toString(r)}]})}_addCheck(e){return new Y({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:x.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Y.create=e=>{var t;return new Y({checks:[],typeName:Le.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...j(e)})};class K extends N{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==i.boolean){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.boolean,received:t.parsedType}),f}return y(e.data)}}K.create=e=>new K({typeName:Le.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...j(e)});class q extends N{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==i.date){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.date,received:t.parsedType}),f}if(isNaN(e.data.getTime()))return p(this._getOrReturnCtx(e),{code:o.invalid_date}),f;const t=new m;let a;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(a=this._getOrReturnCtx(e,a),p(a,{code:o.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(a=this._getOrReturnCtx(e,a),p(a,{code:o.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):r.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new q({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:x.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:x.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}q.create=e=>new q({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Le.ZodDate,...j(e)});class Q extends N{_parse(e){if(this._getType(e)!==i.symbol){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.symbol,received:t.parsedType}),f}return y(e.data)}}Q.create=e=>new Q({typeName:Le.ZodSymbol,...j(e)});class X extends N{_parse(e){if(this._getType(e)!==i.undefined){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.undefined,received:t.parsedType}),f}return y(e.data)}}X.create=e=>new X({typeName:Le.ZodUndefined,...j(e)});class ee extends N{_parse(e){if(this._getType(e)!==i.null){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.null,received:t.parsedType}),f}return y(e.data)}}ee.create=e=>new ee({typeName:Le.ZodNull,...j(e)});class te extends N{constructor(){super(...arguments),this._any=!0}_parse(e){return y(e.data)}}te.create=e=>new te({typeName:Le.ZodAny,...j(e)});class ae extends N{constructor(){super(...arguments),this._unknown=!0}_parse(e){return y(e.data)}}ae.create=e=>new ae({typeName:Le.ZodUnknown,...j(e)});class re extends N{_parse(e){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.never,received:t.parsedType}),f}}re.create=e=>new re({typeName:Le.ZodNever,...j(e)});class ne extends N{_parse(e){if(this._getType(e)!==i.undefined){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.void,received:t.parsedType}),f}return y(e.data)}}ne.create=e=>new ne({typeName:Le.ZodVoid,...j(e)});class ie extends N{_parse(e){const{ctx:t,status:a}=this._processInputParams(e),r=this._def;if(t.parsedType!==i.array)return p(t,{code:o.invalid_type,expected:i.array,received:t.parsedType}),f;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,n=t.data.length<r.exactLength.value;(e||n)&&(p(t,{code:e?o.too_big:o.too_small,minimum:n?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),a.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(p(t,{code:o.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),a.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(p(t,{code:o.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),a.dirty()),t.common.async)return Promise.all([...t.data].map(((e,a)=>r.type._parseAsync(new I(t,e,t.path,a))))).then((e=>m.mergeArray(a,e)));const n=[...t.data].map(((e,a)=>r.type._parseSync(new I(t,e,t.path,a))));return m.mergeArray(a,n)}get element(){return this._def.type}min(e,t){return new ie({...this._def,minLength:{value:e,message:x.toString(t)}})}max(e,t){return new ie({...this._def,maxLength:{value:e,message:x.toString(t)}})}length(e,t){return new ie({...this._def,exactLength:{value:e,message:x.toString(t)}})}nonempty(e){return this.min(1,e)}}function se(e){if(e instanceof oe){const t={};for(const a in e.shape){const r=e.shape[a];t[a]=Ee.create(se(r))}return new oe({...e._def,shape:()=>t})}return e instanceof ie?new ie({...e._def,type:se(e.element)}):e instanceof Ee?Ee.create(se(e.unwrap())):e instanceof Te?Te.create(se(e.unwrap())):e instanceof pe?pe.create(e.items.map((e=>se(e)))):e}ie.create=(e,t)=>new ie({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Le.ZodArray,...j(t)});class oe extends N{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=r.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==i.object){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.object,received:t.parsedType}),f}const{status:t,ctx:a}=this._processInputParams(e),{shape:r,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof re&&"strip"===this._def.unknownKeys))for(const e in a.data)n.includes(e)||s.push(e);const c=[];for(const e of n){const t=r[e],n=a.data[e];c.push({key:{status:"valid",value:e},value:t._parse(new I(a,n,a.path,e)),alwaysSet:e in a.data})}if(this._def.catchall instanceof re){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of s)c.push({key:{status:"valid",value:e},value:{status:"valid",value:a.data[e]}});else if("strict"===e)s.length>0&&(p(a,{code:o.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const r=a.data[t];c.push({key:{status:"valid",value:t},value:e._parse(new I(a,r,a.path,t)),alwaysSet:t in a.data})}}return a.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of c){const a=await t.key,r=await t.value;e.push({key:a,value:r,alwaysSet:t.alwaysSet})}return e})).then((e=>m.mergeObjectSync(t,e))):m.mergeObjectSync(t,c)}get shape(){return this._def.shape()}strict(e){return x.errToObj,new oe({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,a)=>{var r,n,i,s;const o=null!==(i=null===(n=(r=this._def).errorMap)||void 0===n?void 0:n.call(r,t,a).message)&&void 0!==i?i:a.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=x.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new oe({...this._def,unknownKeys:"strip"})}passthrough(){return new oe({...this._def,unknownKeys:"passthrough"})}extend(e){return new oe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new oe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Le.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new oe({...this._def,catchall:e})}pick(e){const t={};return r.objectKeys(e).forEach((a=>{e[a]&&this.shape[a]&&(t[a]=this.shape[a])})),new oe({...this._def,shape:()=>t})}omit(e){const t={};return r.objectKeys(this.shape).forEach((a=>{e[a]||(t[a]=this.shape[a])})),new oe({...this._def,shape:()=>t})}deepPartial(){return se(this)}partial(e){const t={};return r.objectKeys(this.shape).forEach((a=>{const r=this.shape[a];e&&!e[a]?t[a]=r:t[a]=r.optional()})),new oe({...this._def,shape:()=>t})}required(e){const t={};return r.objectKeys(this.shape).forEach((a=>{if(e&&!e[a])t[a]=this.shape[a];else{let e=this.shape[a];for(;e instanceof Ee;)e=e._def.innerType;t[a]=e}})),new oe({...this._def,shape:()=>t})}keyof(){return be(r.objectKeys(this.shape))}}oe.create=(e,t)=>new oe({shape:()=>e,unknownKeys:"strip",catchall:re.create(),typeName:Le.ZodObject,...j(t)}),oe.strictCreate=(e,t)=>new oe({shape:()=>e,unknownKeys:"strict",catchall:re.create(),typeName:Le.ZodObject,...j(t)}),oe.lazycreate=(e,t)=>new oe({shape:e,unknownKeys:"strip",catchall:re.create(),typeName:Le.ZodObject,...j(t)});class ce extends N{_parse(e){const{ctx:t}=this._processInputParams(e),a=this._def.options;if(t.common.async)return Promise.all(a.map((async e=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const a of e)if("dirty"===a.result.status)return t.common.issues.push(...a.ctx.common.issues),a.result;const a=e.map((e=>new c(e.ctx.common.issues)));return p(t,{code:o.invalid_union,unionErrors:a}),f}));{let e;const r=[];for(const n of a){const a={...t,common:{...t.common,issues:[]},parent:null},i=n._parseSync({data:t.data,path:t.path,parent:a});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:a}),a.common.issues.length&&r.push(a.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=r.map((e=>new c(e)));return p(t,{code:o.invalid_union,unionErrors:n}),f}}get options(){return this._def.options}}ce.create=(e,t)=>new ce({options:e,typeName:Le.ZodUnion,...j(t)});const de=e=>e instanceof _e?de(e.schema):e instanceof xe?de(e.innerType()):e instanceof ve?[e.value]:e instanceof we?e.options:e instanceof ke?r.objectValues(e.enum):e instanceof Ie?de(e._def.innerType):e instanceof X?[void 0]:e instanceof ee?[null]:e instanceof Ee?[void 0,...de(e.unwrap())]:e instanceof Te?[null,...de(e.unwrap())]:e instanceof Pe||e instanceof Ce?de(e.unwrap()):e instanceof Se?de(e._def.innerType):[];class le extends N{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.object)return p(t,{code:o.invalid_type,expected:i.object,received:t.parsedType}),f;const a=this.discriminator,r=t.data[a],n=this.optionsMap.get(r);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(p(t,{code:o.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),f)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,a){const r=new Map;for(const a of t){const t=de(a.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const n of t){if(r.has(n))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);r.set(n,a)}}return new le({typeName:Le.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...j(a)})}}function ue(e,t){const a=s(e),n=s(t);if(e===t)return{valid:!0,data:e};if(a===i.object&&n===i.object){const a=r.objectKeys(t),n=r.objectKeys(e).filter((e=>-1!==a.indexOf(e))),i={...e,...t};for(const a of n){const r=ue(e[a],t[a]);if(!r.valid)return{valid:!1};i[a]=r.data}return{valid:!0,data:i}}if(a===i.array&&n===i.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let r=0;r<e.length;r++){const n=ue(e[r],t[r]);if(!n.valid)return{valid:!1};a.push(n.data)}return{valid:!0,data:a}}return a===i.date&&n===i.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class he extends N{_parse(e){const{status:t,ctx:a}=this._processInputParams(e),r=(e,r)=>{if(_(e)||_(r))return f;const n=ue(e.value,r.value);return n.valid?((v(e)||v(r))&&t.dirty(),{status:t.value,value:n.data}):(p(a,{code:o.invalid_intersection_types}),f)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}he.create=(e,t,a)=>new he({left:e,right:t,typeName:Le.ZodIntersection,...j(a)});class pe extends N{_parse(e){const{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==i.array)return p(a,{code:o.invalid_type,expected:i.array,received:a.parsedType}),f;if(a.data.length<this._def.items.length)return p(a,{code:o.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),f;!this._def.rest&&a.data.length>this._def.items.length&&(p(a,{code:o.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...a.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new I(a,e,a.path,t)):null})).filter((e=>!!e));return a.common.async?Promise.all(r).then((e=>m.mergeArray(t,e))):m.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new pe({...this._def,rest:e})}}pe.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new pe({items:e,typeName:Le.ZodTuple,rest:null,...j(t)})};class me extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==i.object)return p(a,{code:o.invalid_type,expected:i.object,received:a.parsedType}),f;const r=[],n=this._def.keyType,s=this._def.valueType;for(const e in a.data)r.push({key:n._parse(new I(a,e,a.path,e)),value:s._parse(new I(a,a.data[e],a.path,e)),alwaysSet:e in a.data});return a.common.async?m.mergeObjectAsync(t,r):m.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,a){return new me(t instanceof N?{keyType:e,valueType:t,typeName:Le.ZodRecord,...j(a)}:{keyType:V.create(),valueType:e,typeName:Le.ZodRecord,...j(t)})}}class fe extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==i.map)return p(a,{code:o.invalid_type,expected:i.map,received:a.parsedType}),f;const r=this._def.keyType,n=this._def.valueType,s=[...a.data.entries()].map((([e,t],i)=>({key:r._parse(new I(a,e,a.path,[i,"key"])),value:n._parse(new I(a,t,a.path,[i,"value"]))})));if(a.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const a of s){const r=await a.key,n=await a.value;if("aborted"===r.status||"aborted"===n.status)return f;"dirty"!==r.status&&"dirty"!==n.status||t.dirty(),e.set(r.value,n.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const a of s){const r=a.key,n=a.value;if("aborted"===r.status||"aborted"===n.status)return f;"dirty"!==r.status&&"dirty"!==n.status||t.dirty(),e.set(r.value,n.value)}return{status:t.value,value:e}}}}fe.create=(e,t,a)=>new fe({valueType:t,keyType:e,typeName:Le.ZodMap,...j(a)});class ge extends N{_parse(e){const{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==i.set)return p(a,{code:o.invalid_type,expected:i.set,received:a.parsedType}),f;const r=this._def;null!==r.minSize&&a.data.size<r.minSize.value&&(p(a,{code:o.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&a.data.size>r.maxSize.value&&(p(a,{code:o.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const n=this._def.valueType;function s(e){const a=new Set;for(const r of e){if("aborted"===r.status)return f;"dirty"===r.status&&t.dirty(),a.add(r.value)}return{status:t.value,value:a}}const c=[...a.data.values()].map(((e,t)=>n._parse(new I(a,e,a.path,t))));return a.common.async?Promise.all(c).then((e=>s(e))):s(c)}min(e,t){return new ge({...this._def,minSize:{value:e,message:x.toString(t)}})}max(e,t){return new ge({...this._def,maxSize:{value:e,message:x.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ge.create=(e,t)=>new ge({valueType:e,minSize:null,maxSize:null,typeName:Le.ZodSet,...j(t)});class ye extends N{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.function)return p(t,{code:o.invalid_type,expected:i.function,received:t.parsedType}),f;function a(e,a){return h({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,u(),d].filter((e=>!!e)),issueData:{code:o.invalid_arguments,argumentsError:a}})}function r(e,a){return h({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,u(),d].filter((e=>!!e)),issueData:{code:o.invalid_return_type,returnTypeError:a}})}const n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Oe){const e=this;return y((async function(...t){const i=new c([]),o=await e._def.args.parseAsync(t,n).catch((e=>{throw i.addIssue(a(t,e)),i})),d=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(d,n).catch((e=>{throw i.addIssue(r(d,e)),i}))}))}{const e=this;return y((function(...t){const i=e._def.args.safeParse(t,n);if(!i.success)throw new c([a(t,i.error)]);const o=Reflect.apply(s,this,i.data),d=e._def.returns.safeParse(o,n);if(!d.success)throw new c([r(o,d.error)]);return d.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ye({...this._def,args:pe.create(e).rest(ae.create())})}returns(e){return new ye({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,a){return new ye({args:e||pe.create([]).rest(ae.create()),returns:t||ae.create(),typeName:Le.ZodFunction,...j(a)})}}class _e extends N{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}_e.create=(e,t)=>new _e({getter:e,typeName:Le.ZodLazy,...j(t)});class ve extends N{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return p(t,{received:t.data,code:o.invalid_literal,expected:this._def.value}),f}return{status:"valid",value:e.data}}get value(){return this._def.value}}function be(e,t){return new we({values:e,typeName:Le.ZodEnum,...j(t)})}ve.create=(e,t)=>new ve({value:e,typeName:Le.ZodLiteral,...j(t)});class we extends N{constructor(){super(...arguments),E.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),a=this._def.values;return p(t,{expected:r.joinValues(a),received:t.parsedType,code:o.invalid_type}),f}if(k(this,E,"f")||O(this,E,new Set(this._def.values),"f"),!k(this,E,"f").has(e.data)){const t=this._getOrReturnCtx(e),a=this._def.values;return p(t,{received:t.data,code:o.invalid_enum_value,options:a}),f}return y(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return we.create(e,{...this._def,...t})}exclude(e,t=this._def){return we.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}E=new WeakMap,we.create=be;class ke extends N{constructor(){super(...arguments),T.set(this,void 0)}_parse(e){const t=r.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==i.string&&a.parsedType!==i.number){const e=r.objectValues(t);return p(a,{expected:r.joinValues(e),received:a.parsedType,code:o.invalid_type}),f}if(k(this,T,"f")||O(this,T,new Set(r.getValidEnumValues(this._def.values)),"f"),!k(this,T,"f").has(e.data)){const e=r.objectValues(t);return p(a,{received:a.data,code:o.invalid_enum_value,options:e}),f}return y(e.data)}get enum(){return this._def.values}}T=new WeakMap,ke.create=(e,t)=>new ke({values:e,typeName:Le.ZodNativeEnum,...j(t)});class Oe extends N{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.promise&&!1===t.common.async)return p(t,{code:o.invalid_type,expected:i.promise,received:t.parsedType}),f;const a=t.parsedType===i.promise?t.data:Promise.resolve(t.data);return y(a.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Oe.create=(e,t)=>new Oe({type:e,typeName:Le.ZodPromise,...j(t)});class xe extends N{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Le.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:a}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:e=>{p(a,e),e.fatal?t.abort():t.dirty()},get path(){return a.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===n.type){const e=n.transform(a.data,i);if(a.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return f;const r=await this._def.schema._parseAsync({data:e,path:a.path,parent:a});return"aborted"===r.status?f:"dirty"===r.status||"dirty"===t.value?g(r.value):r}));{if("aborted"===t.value)return f;const r=this._def.schema._parseSync({data:e,path:a.path,parent:a});return"aborted"===r.status?f:"dirty"===r.status||"dirty"===t.value?g(r.value):r}}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,i);if(a.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===a.common.async){const r=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return"aborted"===r.status?f:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then((a=>"aborted"===a.status?f:("dirty"===a.status&&t.dirty(),e(a.value).then((()=>({status:t.value,value:a.value}))))))}if("transform"===n.type){if(!1===a.common.async){const e=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!b(e))return e;const r=n.transform(e.value,i);if(r instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:r}}return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then((e=>b(e)?Promise.resolve(n.transform(e.value,i)).then((e=>({status:t.value,value:e}))):e))}r.assertNever(n)}}xe.create=(e,t,a)=>new xe({schema:e,typeName:Le.ZodEffects,effect:t,...j(a)}),xe.createWithPreprocess=(e,t,a)=>new xe({schema:t,effect:{type:"preprocess",transform:e},typeName:Le.ZodEffects,...j(a)});class Ee extends N{_parse(e){return this._getType(e)===i.undefined?y(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ee.create=(e,t)=>new Ee({innerType:e,typeName:Le.ZodOptional,...j(t)});class Te extends N{_parse(e){return this._getType(e)===i.null?y(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Te.create=(e,t)=>new Te({innerType:e,typeName:Le.ZodNullable,...j(t)});class Ie extends N{_parse(e){const{ctx:t}=this._processInputParams(e);let a=t.data;return t.parsedType===i.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ie.create=(e,t)=>new Ie({innerType:e,typeName:Le.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...j(t)});class Se extends N{_parse(e){const{ctx:t}=this._processInputParams(e),a={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return w(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new c(a.common.issues)},input:a.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new c(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}Se.create=(e,t)=>new Se({innerType:e,typeName:Le.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...j(t)});class je extends N{_parse(e){if(this._getType(e)!==i.nan){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.nan,received:t.parsedType}),f}return{status:"valid",value:e.data}}}je.create=e=>new je({typeName:Le.ZodNaN,...j(e)});const Ne=Symbol("zod_brand");class Pe extends N{_parse(e){const{ctx:t}=this._processInputParams(e),a=t.data;return this._def.type._parse({data:a,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ae extends N{_parse(e){const{status:t,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return"aborted"===e.status?f:"dirty"===e.status?(t.dirty(),g(e.value)):this._def.out._parseAsync({data:e.value,path:a.path,parent:a})})();{const e=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return"aborted"===e.status?f:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:a.path,parent:a})}}static create(e,t){return new Ae({in:e,out:t,typeName:Le.ZodPipeline})}}class Ce extends N{_parse(e){const t=this._def.innerType._parse(e),a=e=>(b(e)&&(e.value=Object.freeze(e.value)),e);return w(t)?t.then((e=>a(e))):a(t)}unwrap(){return this._def.innerType}}function Re(e,t={},a){return e?te.create().superRefine(((r,n)=>{var i,s;if(!e(r)){const e="function"==typeof t?t(r):"string"==typeof t?{message:t}:t,o=null===(s=null!==(i=e.fatal)&&void 0!==i?i:a)||void 0===s||s,c="string"==typeof e?{message:e}:e;n.addIssue({code:"custom",...c,fatal:o})}})):te.create()}Ce.create=(e,t)=>new Ce({innerType:e,typeName:Le.ZodReadonly,...j(t)});const $e={object:oe.lazycreate};var Le;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Le||(Le={}));const Me=V.create,Ze=W.create,De=je.create,Ue=Y.create,He=K.create,Fe=q.create,Be=Q.create,ze=X.create,Je=ee.create,Ve=te.create,Ge=ae.create,We=re.create,Ye=ne.create,Ke=ie.create,qe=oe.create,Qe=oe.strictCreate,Xe=ce.create,et=le.create,tt=he.create,at=pe.create,rt=me.create,nt=fe.create,it=ge.create,st=ye.create,ot=_e.create,ct=ve.create,dt=we.create,lt=ke.create,ut=Oe.create,ht=xe.create,pt=Ee.create,mt=Te.create,ft=xe.createWithPreprocess,gt=Ae.create,yt={string:e=>V.create({...e,coerce:!0}),number:e=>W.create({...e,coerce:!0}),boolean:e=>K.create({...e,coerce:!0}),bigint:e=>Y.create({...e,coerce:!0}),date:e=>q.create({...e,coerce:!0})},_t=f;var vt=Object.freeze({__proto__:null,defaultErrorMap:d,setErrorMap:function(e){l=e},getErrorMap:u,makeIssue:h,EMPTY_PATH:[],addIssueToContext:p,ParseStatus:m,INVALID:f,DIRTY:g,OK:y,isAborted:_,isDirty:v,isValid:b,isAsync:w,get util(){return r},get objectUtil(){return n},ZodParsedType:i,getParsedType:s,ZodType:N,datetimeRegex:J,ZodString:V,ZodNumber:W,ZodBigInt:Y,ZodBoolean:K,ZodDate:q,ZodSymbol:Q,ZodUndefined:X,ZodNull:ee,ZodAny:te,ZodUnknown:ae,ZodNever:re,ZodVoid:ne,ZodArray:ie,ZodObject:oe,ZodUnion:ce,ZodDiscriminatedUnion:le,ZodIntersection:he,ZodTuple:pe,ZodRecord:me,ZodMap:fe,ZodSet:ge,ZodFunction:ye,ZodLazy:_e,ZodLiteral:ve,ZodEnum:we,ZodNativeEnum:ke,ZodPromise:Oe,ZodEffects:xe,ZodTransformer:xe,ZodOptional:Ee,ZodNullable:Te,ZodDefault:Ie,ZodCatch:Se,ZodNaN:je,BRAND:Ne,ZodBranded:Pe,ZodPipeline:Ae,ZodReadonly:Ce,custom:Re,Schema:N,ZodSchema:N,late:$e,get ZodFirstPartyTypeKind(){return Le},coerce:yt,any:Ve,array:Ke,bigint:Ue,boolean:He,date:Fe,discriminatedUnion:et,effect:ht,enum:dt,function:st,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Re((t=>t instanceof e),t),intersection:tt,lazy:ot,literal:ct,map:nt,nan:De,nativeEnum:lt,never:We,null:Je,nullable:mt,number:Ze,object:qe,oboolean:()=>He().optional(),onumber:()=>Ze().optional(),optional:pt,ostring:()=>Me().optional(),pipeline:gt,preprocess:ft,promise:ut,record:rt,set:it,strictObject:Qe,string:Me,symbol:Be,transformer:ht,tuple:at,undefined:ze,union:Xe,unknown:Ge,void:Ye,NEVER:_t,ZodIssueCode:o,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:c})}};