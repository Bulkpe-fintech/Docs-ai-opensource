"use strict";exports.id=714,exports.ids=[714],exports.modules={72539:(e,t,a)=>{a.d(t,{BJ:()=>y,FS:()=>d,RZ:()=>x,qF:()=>h,sS:()=>w});var r=a(44450),s=a(85760),i=a(16158),n=a(92600),l=a(30148),o=a(33847),p=a(23508),m=a(74938);class c extends i.YN{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig((e=>this.formatMessages(e)),e,{...t,runType:"prompt"})}}class u extends c{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}validateInputOrThrow(e,t){if(this.optional&&!e)return!1;if(!e){const e=new Error(`Error: Field "${t}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw e.name="InputFormatError",e}let a=!1;if(a=Array.isArray(e)?e.every((e=>(0,r.ny)(e))):(0,r.ny)(e),!a){const a="string"==typeof e?e:JSON.stringify(e,null,2),r=new Error(`Error: Field "${t}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: ${a}`);throw r.name="InputFormatError",r}return!0}async formatMessages(e){return this.validateInputOrThrow(e[this.variableName],this.variableName),e[this.variableName]??[]}}class f extends c{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class h extends l.m{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new s.aB(t)}}class b extends f{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new r.cM(await this.prompt.format(e),this.role)}static fromTemplate(e,t,a){return new this(o.PromptTemplate.fromTemplate(e,{templateFormat:a?.templateFormat}),t)}}class g extends c{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let e=[];this.prompt.forEach((t=>{"inputVariables"in t&&(e=e.concat(t.inputVariables))})),this.inputVariables=e}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){const t=this.constructor;if(t._messageClass())return new(t._messageClass())({content:e});if(t.chatMessageClass){const a=t.chatMessageClass();return new a({content:e,role:this.getRoleFromMessageClass(a.lc_name())})}throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if("string"==typeof e)return new this(o.PromptTemplate.fromTemplate(e,t));const a=[];for(const t of e)if("string"==typeof t||"object"==typeof t&&"text"in t){let e="";"string"==typeof t?e=t:"string"==typeof t.text&&(e=t.text??""),a.push(o.PromptTemplate.fromTemplate(e))}else if("object"==typeof t&&"image_url"in t){let e,r=t.image_url??"",s=[];if("string"==typeof r){const t=(0,m.D4)(r).flatMap((e=>"variable"===e.type?[e.name]:[]));if((t?.length??0)>0){if(t.length>1)throw new Error(`Only one format variable allowed per image template.\nGot: ${t}\nFrom: ${r}`);s=[t[0]]}else s=[];r={url:r},e=new p.C({template:r,inputVariables:s})}else{if("object"!=typeof r)throw new Error("Invalid image template");s="url"in r?(0,m.D4)(r.url).flatMap((e=>"variable"===e.type?[e.name]:[])):[],e=new p.C({template:r,inputVariables:s})}a.push(e)}return new this({prompt:a,additionalOptions:t})}async format(e){if(this.prompt instanceof n.L){const t=await this.prompt.format(e);return this.createMessage(t)}{const t=[];for(const a of this.prompt){let r={};if(!("inputVariables"in a))throw new Error(`Prompt ${a} does not have inputVariables defined.`);for(const t of a.inputVariables)r||(r={[t]:e[t]}),r={...r,[t]:e[t]};if(a instanceof n.L){const e=await a.format(r);t.push({type:"text",text:e})}else if(a instanceof p.C){const e=await a.format(r);t.push({type:"image_url",image_url:e})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class d extends g{static _messageClass(){return r.xc}static lc_name(){return"HumanMessagePromptTemplate"}}class w extends g{static _messageClass(){return r.Od}static lc_name(){return"AIMessagePromptTemplate"}}class y extends g{static _messageClass(){return r.tn}static lc_name(){return"SystemMessagePromptTemplate"}}function v(e,t){if("function"==typeof e.formatMessages||(0,r.ny)(e))return e;if(Array.isArray(e)&&"placeholder"===e[0]){const t=e[1];if("string"!=typeof t||"{"!==t[0]||"}"!==t[t.length-1])throw new Error(`Invalid placeholder template: "${e[1]}". Expected a variable name surrounded by curly braces.`);const a=t.slice(1,-1);return new u({variableName:a,optional:!0})}const a=(0,r.K0)(e);let s;if(s="string"==typeof a.content?a.content:a.content.map((e=>"text"in e?{text:e.text}:"image_url"in e?{image_url:e.image_url}:e)),"human"===a._getType())return d.fromTemplate(s,t);if("ai"===a._getType())return w.fromTemplate(s,t);if("system"===a._getType())return y.fromTemplate(s,t);if(r.cM.isInstance(a))return b.fromTemplate(a.content,a.role,t);throw new Error(`Could not coerce message prompt template from input. Received message type: "${a._getType()}".`)}class x extends h{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)if(!(t instanceof r.XQ))for(const a of t.inputVariables)e.add(a);const t=this.inputVariables,a=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),s=new Set([...a].filter((t=>!e.has(t))));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are not used in any of the prompt messages.`);const i=new Set([...e].filter((e=>!a.has(e))));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;const a=await Promise.all(e.content.map((async e=>{if("image_url"!==e.type)return e;let a="";a="string"==typeof e.image_url?e.image_url:e.image_url.url;const r=o.PromptTemplate.fromTemplate(a),s=await r.format(t);return"string"!=typeof e.image_url&&"url"in e.image_url?e.image_url.url=s:e.image_url=s,e})));return e.content=a,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let a=[];for(const e of this.promptMessages)if(e instanceof r.XQ)a.push(await this._parseImagePrompts(e,t));else{const r=e.inputVariables.reduce(((a,r)=>{if(!(r in t||"MessagesPlaceholder"===e.constructor.lc_name()&&e.optional))throw new Error(`Missing value for input variable \`${r.toString()}\``);return a[r]=t[r],a}),{}),s=await e.formatMessages(r);a=a.concat(s)}return a}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),a={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:a};return new x(r)}static fromTemplate(e,t){const a=o.PromptTemplate.fromTemplate(e,t),r=new d({prompt:a});return this.fromMessages([r])}static fromMessages(e,t){const a=e.reduce(((e,a)=>e.concat(a instanceof x?a.promptMessages:[v(a,t)])),[]),s=e.reduce(((e,t)=>t instanceof x?Object.assign(e,t.partialVariables):e),Object.create(null)),i=new Set;for(const e of a)if(!(e instanceof r.XQ))for(const t of e.inputVariables)t in s||i.add(t);return new this({...t,inputVariables:[...i],promptMessages:a,partialVariables:s,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}},32714:(e,t,a)=>{a.d(t,{FewShotPromptTemplate:()=>l});var r=a(92600),s=a(74938),i=a(33847),n=a(72539);class l extends r.L{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.Ns)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),a={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:a};return new l(r)}async format(e){const t=await this.mergePartialAndUserVariables(e),a=await this.getExamples(t),r=await Promise.all(a.map((e=>this.examplePrompt.format(e)))),i=[this.prefix,...r,this.suffix].join(this.exampleSeparator);return(0,s.Xm)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const a=await i.PromptTemplate.deserialize(t);let r;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return r=e.examples,new l({inputVariables:e.input_variables,examplePrompt:a,examples:r,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}n.qF},23508:(e,t,a)=>{a.d(t,{C:()=>n});var r=a(85760),s=a(30148),i=a(74938);class n extends s.m{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,i.Ns)([{type:"image_url",image_url:this.template}],this.templateFormat,e)}}_getPromptType(){return"prompt"}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),a={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:a};return new n(r)}async format(e){const t={};for(const[a,r]of Object.entries(this.template))t[a]="string"==typeof r?r.replace(/{([^{}]*)}/g,((t,a)=>{const r=e[a];return"string"==typeof r||"number"==typeof r?String(r):t})):r;const a=e.url||t.url,r=e.detail||t.detail;if(!a)throw new Error("Must provide either an image URL.");if("string"!=typeof a)throw new Error("url must be a string.");const s={url:a};return r&&(s.detail=r),s}async formatPromptValue(e){const t=await this.format(e);return new r.vX(t)}}}};